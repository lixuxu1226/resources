<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <title>index</title>
    <script type="text/javascript" src="../static/js/jquery.js"></script>
    <link rel="stylesheet" href="../static/css/comon0.css">
    <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no' name='viewport' >
    <meta name="viewport" content="width=device-width" >
    <link rel="stylesheet" href="../static/css/bootstrap.css">
    <link rel="stylesheet" href="../static/css/bootstrap.min.css">
    <link rel="stylesheet" href="../static/css/font-awesome.min.css">
    <link href="../static/css/amaze.css" rel="stylesheet" >
    <link href="../static/css/jquery-ui.css" rel="stylesheet">
    <link href="../static/css/themify-icons.css" rel="stylesheet">
    <link href="../static/css/device.css" rel="stylesheet">
    <link href="../static/css/input.css" rel="stylesheet" >
</head>
<script>
    // $(window).load(function(){
    //     $(".loading").fadeOut()
    // })

    /****/
    $(document).ready(function(){
        var whei=$(window).width()
        $("html").css({fontSize:whei/20})
        $(window).resize(function(){
            var whei=$(window).width()
            $("html").css({fontSize:whei/20})
        });
    });
</script>
<body>
<!-- <div class="canvas" style="opacity: .2">
    <iframe frameborder="0" src="../static/js/index.html" style="width: 100%; height: 100%"></iframe>
</div> -->
<!-- <div class="loading">
    <div class="loadbox"> <img src="../static/img/loading.gif"> 页面加载中... </div>
</div> -->
<div class="head">
    <h1 style="margin-top: 5px">跨区域押解边缘风险预警平台</h1>
    <div class="function" style="left:.1rem; ">
        <nav class="nav nav5">
            <ul>
                <li>
                    <a href="cool.html">实时监控</a>

                </li>
            </ul>
        </nav>
    </div>
    <div class="function" style="left:2.1rem; ">
        <nav class="nav nav5">
            <ul>
                <li>
                    <a href="#">设备管理</a>
                </li>
            </ul>
        </nav>
    </div>
    <div class="function" style="left:4.1rem; ">
        <nav class="nav nav5">
            <ul>
                <li>
                    <a href="#">个人管理</a>
                    <ul>
                        <li><a href="user-profile_2.html">管理员信息</a></li>
                        <li><a href="#" id="logout">注销</a></li>
                    </ul>
                </li>
            </ul>
        </nav>
    </div>
    <div class="weather"><!--<img src="picture/weather.png"><span>多云转小雨</span>--><span id="showTime"></span></div>

    <script>
        var t = null;
        t = setTimeout(time,1000);//開始运行
        function time()
        {
            clearTimeout(t);//清除定时器
            dt = new Date();
            var y=dt.getFullYear();
            var mt=dt.getMonth()+1;
            var day=dt.getDate();
            var h=dt.getHours();//获取时
            var m=dt.getMinutes();//获取分
            var s=dt.getSeconds();//获取秒
            document.getElementById("showTime").innerHTML = y+"年"+mt+"月"+day+"日"+h+"时"+m+"分"+s+"秒";
            t = setTimeout(time,1000); //设定定时器，循环运行
        }

    </script>
</div>
<div class="boxall clearfix">
    <input id="filter-device" type="text" placeholder="搜索" style="width:100%;"></input>
    <!-- <a id="addDeviceBtn" href="#" class="button" data-title="添加新设备"></a> -->
    <table id="datatables" class="device-table" style="width:99%;" >
        <thead >
        <tr>
            <th style="text-align: center">设备名</th>
            <th style="text-align: center">持有者</th>
            <th style="text-align: center">所压犯人</th>
            <th class="disabled-sorting" style="text-align: center">设备状态</th>
        </tr>
        </thead>
        <tbody style="" align="center" id="deviceInfo">
        <!--<tr>-->
            <!--<td>1</td>-->
            <!--<td>PH156231</td>-->
            <!--<td>手持机</td>-->
            <!--<td>张三</td>-->
            <!--<td>接入</td>-->

            <!--<td class="btn-group">-->
                    <!--<button type="button" class="btn btn-white">接入</button>-->
                    <!--<button type="button" class="btn btn-white">登出</button>-->
                    <!--<button type="button" class="btn btn-white">移除</button>-->
            <!--</td>-->
        <!--</tr>-->

        </tbody>
        <tfoot>
        <tr >
            <th style="text-align: center">设备名</th>
            <th style="text-align: center">持有者</th>
            <th style="text-align: center">所压犯人</th>
            <th style="text-align: center">设备状态</th>
        </tr>
        </tfoot>
    </table>
</div>
<div class="back"></div>


<div class="modal fade" id="addNewDeviceModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-body">
                <strong>持有者：</strong>
                <input id="filter-device" type="text" placeholder="持有者" style="width:80%;"></input>
            </div>
        </div>
    </div>
</div>

<!--   Core JS Files   -->
<script src="../static/js/jquery-3.1.1.min.js" type="text/javascript"></script>
<script src="../static/js/bootstrap.min.js" type="text/javascript"></script>
<script src="../static/js/perfect-scrollbar.jquery.min.js" type="text/javascript"></script>
<!--<script src="https://webapi.amap.com/maps?v=1.4.14&key=7dd5769916609fcc5c889c1797c4ebd7"></script>-->
<script src="../static/js/moment-with-locales.js"></script>
<script src="../static/js/jquery.flot.js"></script>
<!--<script src="../static/js/bootstrap-datetimepicker.min.js"></script>-->
<!--<script src="../static/js/bootstrap-datetimepicker.zh-CN.js" type="text/javascript"></script>-->
<script src="../static/js/amaze.js"></script>
<!--<script src="../static/js/flot-charts.js"></script>-->
<!--<script type="text/javascript" src="../static/js/echarts.js"></script>-->
<script type="text/javascript" src="../static/js/device.js"></script>
<script src="../static/js/jquery.datatables.js"></script>
<!-- <script type="text/javascript" src="../static/js/input.js"></script> -->
<script type="text/javascript" src="../static/js/logout.js"></script>
<script type="text/javascript">

    // window.addEventListener('resize', function() {
    //     var canvas = document.getElementsByClassName("canvas")[0];
    //     canvas.style.height = "" + document.body.scrollHeight + "px";
    // });
    $(document).ready(function() {
        var main = document.getElementsByClassName("clearfix")[0];
        main.style.height = "" + (window.innerHeight * 0.9) + "px";
            var data=[
                {
                    "id": "14",
                    "deviceStatus": true,
                    "prisoner": {
                        "prisonerName": "1231",
                    },
                    "user": {
                        "userName": "3333",
                    },
                },
                {
                    "id": "14",
                    "deviceStatus": true,
                    "prisoner": {
                        "prisonerName": "1231",
                    },
                    "user": {
                        "userName": "3333",
                    },
                },
                {
                    "id": "14",
                    "deviceStatus": false,
                    "prisoner": {
                        "prisonerName": "1231",
                    },
                    "user": {
                        "userName": "3333",
                    },
                },
                {
                    "id": "14",
                    "deviceStatus": true,
                    "prisoner": {
                        "prisonerName": "1231",
                    },
                    "user": {
                        "userName": "3333",
                    },
                },
                {
                    "id": "14",
                    "deviceStatus": false,
                    "prisoner": {
                        "prisonerName": "1231",
                    },
                    "user": {
                        "userName": "3333",
                    },
                },
                
            ]
            //var data;
            // $.ajax({
            //         url:"http://10.108.122.144:8089/devices/get_all",
            //         type: "GET",
            //         dataType:"JSON",
            //         async:false,
            //         success: function(msg) {
            //             // console.log(msg);
            //             data = msg;


            //         }

            //     });
            // console.log(data);


            $('#datatables').DataTable({
                "pagingType": "full_numbers",
                "searching": true,
                "lengthChange": false,
                "info": false,
                destroy:true,
                language: {
                    "paging": {
                        "first": "首页",
                        "previous": "前一页",
                        "next": "后一页",
                        "last": "尾页"
                    },
                    "zeroRecords": "没有检索到数据"
                },
                "processing": true,//DataTables载入数据时，是否显示‘进度’提示
                // "serverSide": true,//启动服务器端数据导入
                "pagingType":'full_numbers',
                // "ajax.urlOption":"http://10.108.122.144:8089/devices/get_all",
                "ajax": {
                    "data": function (d) {
                        var info = $('#datatables').DataTable().page.info();
                        d.pageNo = info.page;
                        var filter = $('#filter-device').val();
                        //指定检索参数名称，后台参数名为extraSerach
                        d.extraSerach=filter;
                    }
                },
                "dom": '<l<t>ip>',


                data:data,

                columns: [
                    { data: 'id' },
                    { data: 'user.userName' , defaultContent: ""},
                    { data: 'prisoner.prisonerName', defaultContent: "" },
                    { data:'deviceStatus',
                        render:function (data,type,full) {
                            if(data==true){
                                return '<label></label><span device-online></span>'
                            }else {
                                return '<label></label><span device-offline></span>'
                            }
                        }
                    }
                ],

        });
        $('#filter-device').bind("input propertychange",function(event) {
            var filter = $('#filter-device').val();
            var table = $('#datatables').DataTable();
            table.search(filter).draw();
        });

        var table=$('#datatables').DataTable();

        //设备登出
        var lout = "您确定断开与此台设备的连接吗？";
        var lin = "您确定恢复与此台设备的连接吗？";
        var del="您确定移除此台设备吗？";
        $("#datatables tbody").on('click', '.remove', function(e) {
            // console.log( table.row(this).data() );
            // $tr = $(this).closest('tr');
            // console.log(table.row($tr).data())
            if(confirm(del)){
                $tr = $(this).closest('tr');
                // console.log(table.row(this));
                // table.row($tr).remove().draw();
                var id=table.row($tr).data().id;
                console.log(id);
                device.deviceDelete(id);
                table.row($tr).remove().draw();
                // table.draw(true);
                // e.preventDefault();
            }

        });
        $("#datatables tbody").on('click', '.logout', function(e) {
            // console.log( table.row(this).data() );
            // $tr = $(this).closest('tr');
            // console.log(table.row($tr).data())
            if(confirm(lout)){
                $tr = $(this).closest('tr');
                // console.log(table.row(this));
                // table.row($tr).remove().draw();
                var id=table.row($tr).data().id;
                console.log(id);
                device.deviceLogout(id);
                table.ajax.reload();
                table.draw(true)
                // e.preventDefault();
            }

        });
        $("#datatables tbody").on('click', '.login', function(e) {
            // console.log( table.row(this).data() );
            // $tr = $(this).closest('tr');
            // console.log(table.row($tr).data())
            if(confirm(lin)){
                $tr = $(this).closest('tr');
                // console.log(table.row(this));
                // table.row($tr).remove().draw();
                var id=table.row($tr).data().id;
                console.log(id);
                device.deviceLogin(id);
                table.draw(true);
                // e.preventDefault();
            }
        });
        $("#addDeviceBtn").click(function() {
            $("#addNewDeviceModal").modal("show")
        });
    });
</script>

</body>
</html>
