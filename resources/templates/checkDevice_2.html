<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <title>index</title>
    <script type="text/javascript" src="../static/js/jquery.js"></script>
    <link rel="stylesheet" href="../static/css/comon0.css">
    <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no' name='viewport' >
    <meta name="viewport" content="width=device-width" >
    <link rel="stylesheet" href="../static/css/bootstrap.css">
    <link rel="stylesheet" href="../static/css/bootstrap.min.css">
    <link rel="stylesheet" href="../static/css/font-awesome.min.css">
    <link href="../static/css/amaze.css" rel="stylesheet" >
    <link href="../static/css/jquery-ui.css" rel="stylesheet">
    <link href="../static/css/themify-icons.css" rel="stylesheet">
    <link href="../static/css/device.css" rel="stylesheet">
    <link href="../static/css/input.css" rel="stylesheet" >
</head>
<script>
    $(window).load(function(){
        $(".loading").fadeOut()
    })

    /****/
    $(document).ready(function(){
        var whei=$(window).width()
        $("html").css({fontSize:whei/20})
        $(window).resize(function(){
            var whei=$(window).width()
            $("html").css({fontSize:whei/20})
        });
    });
</script>
<body>
<div class="canvas" style="opacity: .2">
    <iframe frameborder="0" src="../static/js/index.html" style="width: 100%; height: 100%"></iframe>
</div>
<div class="loading">
    <div class="loadbox"> <img src="../static/img/loading.gif"> 页面加载中... </div>
</div>
<div class="head">
    <h1 style="margin-top: 5px">跨区域押解边缘风险预警平台</h1>
    <div class="function" style="left:.1rem; ">
        <nav class="nav nav5">
            <ul>
                <li>
                    <a href="cool.html">实时监控</a>

                </li>
            </ul>
        </nav>
    </div>
    <div class="function" style="left:2.1rem; ">
        <nav class="nav nav5">
            <ul>
                <li>
                    <a href="#">设备管理</a>
                    <ul>
                        <li><a href="#">查看设备信息</a></li>
                        <li><a href="useDeviceLog.html">操作日志</a></li>
                    </ul>
                </li>
            </ul>
        </nav>
    </div>
    <div class="function" style="left:4.1rem; ">
        <nav class="nav nav5">
            <ul>
                <li>
                    <a href="#">用户管理</a>
                    <ul>
                        <li><a href="user-profile_2.html">查看用户信息</a></li>
                        <li><a href="#" id="logout">注销</a></li>
                    </ul>
                </li>
            </ul>
        </nav>
    </div>
    <div class="weather"><!--<img src="picture/weather.png"><span>多云转小雨</span>--><span id="showTime"></span></div>

    <script>
        var t = null;
        t = setTimeout(time,1000);//開始运行
        function time()
        {
            clearTimeout(t);//清除定时器
            dt = new Date();
            var y=dt.getFullYear();
            var mt=dt.getMonth()+1;
            var day=dt.getDate();
            var h=dt.getHours();//获取时
            var m=dt.getMinutes();//获取分
            var s=dt.getSeconds();//获取秒
            document.getElementById("showTime").innerHTML = y+"年"+mt+"月"+day+"日"+h+"时"+m+"分"+s+"秒";
            t = setTimeout(time,1000); //设定定时器，循环运行
        }

    </script>
</div>
<div class="boxall clearfix">
    <input id="filter-device" type="text" placeholder="搜索" style="width:80%;"></input>
    <a id="addDeviceBtn" href="#" class="button" data-title="添加新设备"></a>
    <table id="datatables" class="device-table" style="width:99%;" >
        <thead >
        <tr>
            <th style="text-align: center">ID</th>
            <th style="text-align: center">设备编号</th>
            <th style="text-align: center">设备类型</th>
            <th style="text-align: center">持有者</th>
            <th style="text-align: center">设备状态</th>
            <th class="disabled-sorting" style="text-align: center">Actions</th>
        </tr>
        </thead>
        <tbody style="" align="center" id="deviceInfo">
        <!--<tr>-->
            <!--<td>1</td>-->
            <!--<td>PH156231</td>-->
            <!--<td>手持机</td>-->
            <!--<td>张三</td>-->
            <!--<td>接入</td>-->

            <!--<td class="btn-group">-->
                    <!--<button type="button" class="btn btn-white">接入</button>-->
                    <!--<button type="button" class="btn btn-white">登出</button>-->
                    <!--<button type="button" class="btn btn-white">移除</button>-->
            <!--</td>-->
        <!--</tr>-->

        </tbody>
        <tfoot>
        <tr >
            <th style="text-align: center">ID</th>
            <th style="text-align: center">设备编号</th>
            <th style="text-align: center">设备类型</th>
            <th style="text-align: center">持有者</th>
            <th style="text-align: center">设备状态</th>
            <th style="text-align: center">Actions</th>
        </tr>
        </tfoot>
    </table>
</div>
<div class="back"></div>


<div class="modal fade" id="addNewDeviceModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-body">
                <strong>持有者：</strong>
                <input id="filter-device" type="text" placeholder="持有者" style="width:80%;"></input>
            </div>
        </div>
    </div>
</div>

<!--   Core JS Files   -->
<script src="../static/js/jquery-3.1.1.min.js" type="text/javascript"></script>
<script src="../static/js/bootstrap.min.js" type="text/javascript"></script>
<script src="../static/js/perfect-scrollbar.jquery.min.js" type="text/javascript"></script>
<!--<script src="https://webapi.amap.com/maps?v=1.4.14&key=7dd5769916609fcc5c889c1797c4ebd7"></script>-->
<script src="../static/js/moment-with-locales.js"></script>
<script src="../static/js/jquery.flot.js"></script>
<!--<script src="../static/js/bootstrap-datetimepicker.min.js"></script>-->
<!--<script src="../static/js/bootstrap-datetimepicker.zh-CN.js" type="text/javascript"></script>-->
<script src="../static/js/amaze.js"></script>
<!--<script src="../static/js/flot-charts.js"></script>-->
<!--<script type="text/javascript" src="../static/js/echarts.js"></script>-->
<script type="text/javascript" src="../static/js/device.js"></script>
<script src="../static/js/jquery.datatables.js"></script>
<!-- <script type="text/javascript" src="../static/js/input.js"></script> -->
<script type="text/javascript" src="../static/js/logout.js"></script>
<script type="text/javascript">

    window.addEventListener('resize', function() {
        var canvas = document.getElementsByClassName("canvas")[0];
        canvas.style.height = "" + document.body.scrollHeight + "px";
    });
    $(document).ready(function() {
            var data=[
                {
                    "id": "1",
                    "deviceNo": "pad20190506190918",
                    "deviceStatus": true,
                    "deviceType": "pad",
                    "createAt": 1557140958000,
                    "user": {
                        "id": "1",
                        "uid": null,
                        "userName": "jojo",
                        "password": "123456",
                        "phone": null,
                        "createAt": 1557140947000,
                        "tokenCreateAt": null,
                        "loginToken": null
                    },
                    "uid": "1"
                },
                {
                    "id": "2",
                    "deviceNo": "phone20190508210627",
                    "deviceStatus": false,
                    "deviceType": "phone",
                    "createAt": 1557320787000,
                    "user": {
                        "id": "1",
                        "uid": null,
                        "userName": "jojo",
                        "password": "123456",
                        "phone": null,
                        "createAt": 1557140947000,
                        "tokenCreateAt": null,
                        "loginToken": null
                    },
                    "uid": "1"
                },
                {
                    "id": "3",
                    "deviceNo": "phone20190508214135",
                    "deviceStatus": false,
                    "deviceType": "phone",
                    "createAt": 1557322895000,
                    "user": null,
                    "uid": null
                },
                {
                    "id": "4",
                    "deviceNo": "000000000050000",
                    "deviceStatus": true,
                    "deviceType": "phone",
                    "createAt": 1557327549000,
                    "user": {
                        "id": "2",
                        "uid": null,
                        "userName": "wzy",
                        "password": "123456",
                        "phone": null,
                        "createAt": 1557327524000,
                        "tokenCreateAt": null,
                        "loginToken": null
                    },
                    "uid": "2"
                },
                {
                    "id": "5",
                    "deviceNo": "000004000000000",
                    "deviceStatus": false,
                    "deviceType": "phone",
                    "createAt": 1557328253000,
                    "user": null,
                    "uid": null
                },
                {
                    "id": "6",
                    "deviceNo": "000000000800000",
                    "deviceStatus": false,
                    "deviceType": "phone",
                    "createAt": 1557328404000,
                    "user": {
                        "id": "4",
                        "uid": null,
                        "userName": "aaa",
                        "password": "123456",
                        "phone": null,
                        "createAt": 1557328400000,
                        "tokenCreateAt": null,
                        "loginToken": null
                    },
                    "uid": "4"
                },
                {
                    "id": "7",
                    "deviceNo": "000000007000000",
                    "deviceStatus": false,
                    "deviceType": "pad",
                    "createAt": 1557328679000,
                    "user": {
                        "id": "4",
                        "uid": null,
                        "userName": "aaa",
                        "password": "123456",
                        "phone": null,
                        "createAt": 1557328400000,
                        "tokenCreateAt": null,
                        "loginToken": null
                    },
                    "uid": "4"
                },
                {
                    "id": "8",
                    "deviceNo": "000000000000006",
                    "deviceStatus": false,
                    "deviceType": "phone",
                    "createAt": 1557329039000,
                    "user": {
                        "id": "5",
                        "uid": null,
                        "userName": "test",
                        "password": "123456",
                        "phone": null,
                        "createAt": 1557328790000,
                        "tokenCreateAt": null,
                        "loginToken": null
                    },
                    "uid": "5"
                },
                {
                    "id": "9",
                    "deviceNo": "000000000000001",
                    "deviceStatus": false,
                    "deviceType": "phone",
                    "createAt": 1557371620000,
                    "user": {
                        "id": "10",
                        "uid": null,
                        "userName": "qwe",
                        "password": "123456",
                        "phone": null,
                        "createAt": 1557371611000,
                        "tokenCreateAt": "2019-05-09 11:41:34.0",
                        "loginToken": null
                    },
                    "uid": "10"
                },
                {
                    "id": "10",
                    "deviceNo": "000000000000009",
                    "deviceStatus": true,
                    "deviceType": "phone",
                    "createAt": 1557372422000,
                    "user": {
                        "id": "12",
                        "uid": null,
                        "userName": "987",
                        "password": "123456",
                        "phone": null,
                        "createAt": 1557372406000,
                        "tokenCreateAt": "2019-05-09 11:28:27.0",
                        "loginToken": null
                    },
                    "uid": "12"
                },
                {
                    "id": "11",
                    "deviceNo": "000000000000002",
                    "deviceStatus": false,
                    "deviceType": "phone",
                    "createAt": 1557386560000,
                    "user": {
                        "id": "14",
                        "uid": null,
                        "userName": "edge",
                        "password": "123456",
                        "phone": null,
                        "createAt": 1557386507000,
                        "tokenCreateAt": "2019-05-09 15:21:52.0",
                        "loginToken": null
                    },
                    "uid": "14"
                },
                {
                    "id": "12",
                    "deviceNo": "000000000000007",
                    "deviceStatus": true,
                    "deviceType": "phone",
                    "createAt": 1557387981000,
                    "user": {
                        "id": "19",
                        "uid": null,
                        "userName": "1111",
                        "password": "123456",
                        "phone": null,
                        "createAt": 1557387941000,
                        "tokenCreateAt": "2019-05-09 15:46:39.0",
                        "loginToken": null
                    },
                    "uid": "19"
                },
                {
                    "id": "13",
                    "deviceNo": "000000000000008",
                    "deviceStatus": true,
                    "deviceType": "phone",
                    "createAt": 1557388166000,
                    "user": {
                        "id": "20",
                        "uid": null,
                        "userName": "2222",
                        "password": "123456",
                        "phone": null,
                        "createAt": 1557388139000,
                        "tokenCreateAt": "2019-05-09 15:49:38.0",
                        "loginToken": null
                    },
                    "uid": "20"
                },
                {
                    "id": "14",
                    "deviceNo": "000000000000000",
                    "deviceStatus": true,
                    "deviceType": "phone",
                    "createAt": 1557388251000,
                    "user": {
                        "id": "21",
                        "uid": null,
                        "userName": "3333",
                        "password": "123456",
                        "phone": null,
                        "createAt": 1557388217000,
                        "tokenCreateAt": null,
                        "loginToken": null
                    },
                    "uid": "21"
                }
            ]
            //var data;
            // $.ajax({
            //         url:"http://10.108.122.144:8089/devices/get_all",
            //         type: "GET",
            //         dataType:"JSON",
            //         async:false,
            //         success: function(msg) {
            //             // console.log(msg);
            //             data = msg;


            //         }

            //     });
            // console.log(data);


            $('#datatables').DataTable({
                "pagingType": "full_numbers",
                "searching": true,
                "lengthChange": false,
                "info": false,
                destroy:true,
                language: {
                    "paging": {
                        "first": "首页",
                        "previous": "前一页",
                        "next": "后一页",
                        "last": "尾页"
                    },
                    "zeroRecords": "没有检索到数据"
                },
                "processing": true,//DataTables载入数据时，是否显示‘进度’提示
                // "serverSide": true,//启动服务器端数据导入
                "pagingType":'full_numbers',
                // "ajax.urlOption":"http://10.108.122.144:8089/devices/get_all",
                "ajax": {
                    "data": function (d) {
                        var info = $('#datatables').DataTable().page.info();
                        d.pageNo = info.page;
                        var filter = $('#filter-device').val();
                        //指定检索参数名称，后台参数名为extraSerach
                        d.extraSerach=filter;
                    }
                },
                "dom": '<l<t>ip>',


                data:data,

                columns: [
                    { data: 'id' },
                    { data: 'deviceNo'},
                    { data: 'deviceType', defaultContent: "" },
                    { data: 'user.userName' , defaultContent: ""},
                    { data: 'deviceStatus' ,
                        render:function (data,type,full) {
                            if(data==true){
                                return "接入"
                            }else {
                                return "登出"
                            }
                        },
                        defaultContent: ""
                    },
                    {data:'deviceStatus',
                        render:function (data,type,full) {
                            var str;
                            if(data==true){

                                str="<td class=\"text-right\">\n" +
                                    "<a  class=\"btn btn-simple btn-info btn-icon logout\"><span class=\"glyphicon glyphicon-ban-circle\"></a>\n" +
                                    "<a  class=\"btn btn-simple btn-danger btn-icon remove\" ><span class=\"glyphicon glyphicon-trash\"></a>\n" +
                                    " </td>\n"
                            }else {
                                str="<td class=\"text-right\">\n" +
                                    "<a  class=\"btn btn-simple btn-info btn-icon login \" ><span class=\"glyphicon glyphicon-ok-circle\"></span></a>\n" +
                                    "<a  class=\"btn btn-simple btn-danger btn-icon remove\" ><span class=\"glyphicon glyphicon-trash\"></a>\n" +
                                    " </td>\n"

                            }
                            return str
                        }
                    }
                ],

        });
        $('#filter-device').bind("input propertychange",function(event) {
            var filter = $('#filter-device').val();
            var table = $('#datatables').DataTable();
            table.search(filter).draw();
        });

        var table=$('#datatables').DataTable();

        //设备登出
        var lout = "您确定断开与此台设备的连接吗？";
        var lin = "您确定恢复与此台设备的连接吗？";
        var del="您确定移除此台设备吗？";
        $("#datatables tbody").on('click', '.remove', function(e) {
            // console.log( table.row(this).data() );
            // $tr = $(this).closest('tr');
            // console.log(table.row($tr).data())
            if(confirm(del)){
                $tr = $(this).closest('tr');
                // console.log(table.row(this));
                // table.row($tr).remove().draw();
                var id=table.row($tr).data().id;
                console.log(id);
                device.deviceDelete(id);
                table.row($tr).remove().draw();
                // table.draw(true);
                // e.preventDefault();
            }

        });
        $("#datatables tbody").on('click', '.logout', function(e) {
            // console.log( table.row(this).data() );
            // $tr = $(this).closest('tr');
            // console.log(table.row($tr).data())
            if(confirm(lout)){
                $tr = $(this).closest('tr');
                // console.log(table.row(this));
                // table.row($tr).remove().draw();
                var id=table.row($tr).data().id;
                console.log(id);
                device.deviceLogout(id);
                table.ajax.reload();
                table.draw(true)
                // e.preventDefault();
            }

        });
        $("#datatables tbody").on('click', '.login', function(e) {
            // console.log( table.row(this).data() );
            // $tr = $(this).closest('tr');
            // console.log(table.row($tr).data())
            if(confirm(lin)){
                $tr = $(this).closest('tr');
                // console.log(table.row(this));
                // table.row($tr).remove().draw();
                var id=table.row($tr).data().id;
                console.log(id);
                device.deviceLogin(id);
                table.draw(true);
                // e.preventDefault();
            }
        });
        $("#addDeviceBtn").click(function() {
            $("#addNewDeviceModal").modal("show")
        });
    });
</script>

</body>
</html>
