<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <title>index</title>
    <script type="text/javascript" src="../static/js/jquery.js"></script>
    <link rel="stylesheet" href="../static/css/comon0.css">
    <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no' name='viewport' >
    <meta name="viewport" content="width=device-width" >
    <link rel="stylesheet" href="../static/css/bootstrap.css">
    <link rel="stylesheet" href="../static/css/bootstrap.min.css">
    <link href="../static/css/amaze.css" rel="stylesheet" >
    <link href="../static/css/jquery-ui.css" rel="stylesheet">
    <link href="../static/css/themify-icons.css" rel="stylesheet">
    <link href="../static/css/main.css" rel="stylesheet">
    <link href="../static/css/input.css" rel="stylesheet">
    <style>

        .demo-placeholder {
            width: 100%;
            height: 100%;
            font-size: 14px;
            line-height: 1.2em;
            position: relative;
            margin-top: 8px;
            /*background-color: floralwhite;*/

        }
        .inner-placeholder{
            width: 40px;height: 40px;top:0px;
            position: absolute;
            /*z-index: ;*/

            right: 10px;
            top:10px;

        }
    </style>
</head>
<script>
    // $(window).load(function(){
    //     $(".loading").fadeOut()
    // })

    /****/
    $(document).ready(function(){
        var whei=$(window).width()
        $("html").css({fontSize:whei/20})
        $(window).resize(function(){
            var whei=$(window).width()
            $("html").css({fontSize:whei/20})
        });
    });
</script>
<body>
<!-- <div class="canvas" style="opacity: .2">
    <iframe frameborder="0" src="../static/js/index.html" style="width: 100%; height: 100%"></iframe>
</div> -->
<!-- <div class="loading">
    <div class="loadbox"> <img src="../static/img/loading.gif"> 页面加载中... </div>
</div> -->
<div class="head">
    <h1 style="margin-top: 5px">跨区域押解边缘风险预警平台</h1>
    <div class="function" style="left:.1rem; ">
        <nav class="nav nav5">
            <ul>
                <li>
                    <a href="#">实时监控</a>

                </li>
            </ul>
        </nav>
    </div>
    <div class="function" style="left:2.1rem; ">
        <nav class="nav nav5">
            <ul>
                <li>
                	<li><a href="user-profile_2.html">个人信息</a></li>
<!--                     <a href="checkDevice_2.html">设备管理</a>
                    <ul>
                        <li><a href="checkDevice_2.html">查看设备信息</a></li>
                        <li><a href="useDeviceLog.html">操作日志</a></li>
                    </ul> -->
                </li>
            </ul>
        </nav>
    </div>
    <div class="function" style="left:4.1rem;">
        <nav class="nav nav5">
            <ul>
                <li>
                	<li><a href="#" id="logout">注销</a></li>
<!--                     <a href="#">个人管理</a>
                    <ul>
                        <li><a href="user-profile_2.html">管理员信息</a></li>
                        <li><a href="#" id="logout">注销</a></li>
                    </ul> -->
                </li>
            </ul>
        </nav>
    </div>
    <div class="weather"><img src="../static/img/wifi.png" style="width: 6%;"><span id="delay">40ms</span><span id="showTime"></span></div>

    <script>
        var t = null;
        t = setTimeout(time,1000);//開始运行
        function time()
        {
            clearTimeout(t);//清除定时器
            dt = new Date();
            var y=dt.getFullYear();
            var mt=dt.getMonth()+1;
            var day=dt.getDate();
            var h=dt.getHours();//获取时
            var m=dt.getMinutes();//获取分
            var s=dt.getSeconds();//获取秒
            document.getElementById("showTime").innerHTML = " " + y+"年"+mt+"月"+day+"日"+h+"时"+m+"分"+s+"秒";
            t = setTimeout(time,1000); //设定定时器，循环运行
        }
    </script>
</div>
<div class="mainbox">
    <ul class="clearfix">
        <li>
            <div class="boxall" style="height: 4.3rem">
                <!--<div class="alltitle">边缘设备</div>-->
<!--                <div id='deviceFullScreen' class="inner-placeholder" style="background: url(../static/img/fullScreen.png);z-index: 4"></div>-->
                <!--background: url(../static/img/fullScreen.png)-->
                <div class="content" style="height: 100%" id="device">
                	<div class="alltitle">设备云图</div>
                        <!--<div class="row" style="height: 350px">-->
                    <div id="device-chart" class="demo-placeholder" style="height: 230px"></div>
                    <!-- <div id='refresh-device-chart' class="inner-placeholder" style="background: url(../static/img/refresh.png)"></div> -->
                </div>
            </div>
            <div class="boxall" style="height: 2.1rem">
                <!--<div class="alltitle">设备状态</div>-->
                <div class="content" style="height: 100%">
                	<div class="alltitle" id="device-title">无设备</div>
                    <div id="deviceInfo-chart" class="demo-placeholder" style="height: 120px"></div>
                </div>
            </div>
            <div class="boxall" style="height: 3.1rem">
                <div class="alltitle">押解信息</div>
                <div class="demo-placeholder" id="rollingTaskDiv" style="overflow: auto;height:90%">
                    <table id="task-table" style="text-align: center; border-collapse: separate;width:99%;max-height:98%;">
                        <thead>
                            <tr>
                                <th>任务号</th>
                                <th>车牌号</th>
                                <th>犯人数</th>
                                <th>警员数</th>
                                <th>级别</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>暂无</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </li>
        <li>
            <div class="map" style="height:6.4rem">
                <div class="card" style="height:100%; width: 100%;">
                    <div class="content" style="height:100%; width: 100%;">
                        <div id="map-chart" class="demo-placeholder" style="height: 100%"></div>
                        <div id='location' class="inner-placeholder" style="right: 60px;background: url(../static/img/location.png)"></div>
                        <div id='mapFullScreen' class="inner-placeholder" style="background: url(../static/img/fullScreen.png)"></div>
                        <div class="legend">
                            <img src="../static/img/car.png" style="width: 15%;"/>
                            <b style="color:blue">押解车</b><br>
                            <img src="../static/img/red_car.png" style="width: 15%;"/>
                            <b style="color:blue">高风险犯人所在车辆</b><br>
                            <img src="../static/img/yellow_car.png" style="width: 15%;"/>
                            <b style="color:blue">当前犯人所在车辆</b>
                        </div>
                    </div>
                </div>
            </div>
            <div class="boxall" style="margin-top:14px;height: 3.1rem">
                <div class="alltitle">犯人风险数据</div>
                <div class="card" style="height:100%; width: 100%;">
                    <div id="realtime-chart" class="demo-placeholder" style="height: 100%"></div>
                    <div class="inner-placeholder" style="width:20%;height: 100%;text-align: center;">
                        <img id="prisoner-avatar" src="../static/img/peo.png" onclick="showPrisonerInfo()" title="点击查看犯人详情" style="cursor:pointer;text-align: center;vertical-align: middle;max-width:100%;max-height:50%;"/>
                        <a href="#" id="prisoner" title="点击选择犯人" style="text-align: center;display: inline-block;width: 100%;">选择</a>
                        <a href="#" id="prisoner_risk" style="padding-left:10%;text-align: left;display: inline-block;width: 100%;">风险：0</a>
                        <a href="#" id="prisoner_heartbeat" style="padding-left:10%;text-align: left;display: inline-block;width: 100%;">心率：0</a>
                    </div>
                </div>
            </div>
        </li>
        <li>
            <div class="boxall" style="height:3.17rem">
<!--                <nav class="nav nav5" style="margin-left: 30%;margin-right: 30%; height: .5rem;">-->
<!--                    <ul>-->
<!--                        <li>-->
<!--                            <a id="myDropdown1">A车摄像头1号</a>-->
<!--                            <ul>-->
<!--                                <li><a id="A车摄像头2号" onclick="changeCamera(this)">A车摄像头2号</a></li>-->
<!--                                <li><a id="A车摄像头3号" onclick="changeCamera(this)">A车摄像头3号</a></li>-->
<!--                            </ul>-->
<!--                        </li>-->
<!--                    </ul>-->
<!--                </nav>-->
                <video id="video1" title="车内监控" src="http://vd4.bdstatic.com/mda-hmqps190r6746axi/sc/mda-hmqps190r6746axi.mp4" width=100%; controls playsInline webkit-playsinline [autoplay] style="padding-top: 1%">
                </video>
            </div>
            <div class="boxall" style="height: 3.17rem">
<!--                <nav class="nav nav5" style="margin-left: 30%;margin-right: 30%; height: .5rem;">-->
<!--                    <ul>-->
<!--                        <li>-->
<!--                            <a href="#">B车摄像头2号</a>-->
<!--                            <ul>-->
<!--                                <li><a id="B车摄像头1号" onclick="changeCamera(this)">B车摄像头1号</a></li>-->
<!--                                <li><a id="B车摄像头3号" onclick="changeCamera(this)">B车摄像头3号</a></li>-->
<!--                            </ul>-->
<!--                        </li>-->
<!--                    </ul>-->
<!--                </nav>-->
                <video id="video2" title="周围环境" src="../static/img/16.mp4" width=100%;  controls playsInline webkit-playsinline [autoplay] style="padding-top: 1%">
                </video>
            </div>
            <div class="boxall" style="height: 3.16rem">
                <div class="alltitle">异常事件列表</div>
                <div class="demo-placeholder" id="rollingAlertDiv" style="overflow: auto;height:90%">
                    <table id="alert-table" style="text-align: center; border-collapse: separate;width:99%;max-height:98%;">
                        <thead>
                            <tr>
                                <th>犯人</th>
                                <th>时间</th>
                                <th>车辆</th>
                                <th>状态</th>
                                <th>级别</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>暂无</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </li>
    </ul>
</div>
<div class="back"></div>
<!-- Modal -->
<div class="modal fade" id="showInfoModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-body">
                <p id="info_modal">网络异常</p>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="choosePrisonerModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-body">
                <input id="filter-prisoner" type="text" placeholder="搜索" style="color:#ffffff;width: 90%;display:block;margin-left:auto;margin-right:auto;"></input>
                <table id="prisoner-table" style="margin: auto; border-collapse: separate; border-spacing:8px 5px">
                    <tbody>
                        <tr><td>暂无</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="taskInfoModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-body">
                <ul class="profile">
		            <li>
		                <ul class="profile-text">
		                    <li><b>任务号</b></li>
		                    <li id="task-id">YJ1235</li>
		                </ul>
		            </li>
		            <li>
		                <ul class="profile-text">
		                    <li><b>押解车</b></li>
		                    <li id="task-cars">京A1234、京A1234、京A1234、京A1234</li>
		                </ul>
		            </li>
		            <li>
		                <ul class="profile-text">
		                    <li><b>犯人</b></li>
		                    <li id="task-prisoners">张某某、李某某、王某某、赵某某、陈某某</li>
		                </ul>
		            </li>
		            <li>
		                <ul class="profile-text">
		                    <li><b>警员</b></li>
		                    <li id="task-polices">张警官、李警官、王警官、刘警官</li>
		                </ul>
		            </li>
		            <li>
		                <ul class="profile-text">
		                    <li><b>级别</b></li>
		                    <li id="task-level">一级</li>
		                </ul>
		            </li>
		            <li>
		                <ul class="profile-text">
		                    <li><b>详情</b></li>
		                    <li id="task-detail">押解犯人从A监狱到B监狱</li>
		                </ul>
		            </li>
		        </ul>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="carInfoModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-body">
                <video id="video3" src="../static/img/16.mp4" width=100%; controls playsInline webkit-playsinline [autoplay] style="padding-top: 1%;width: 100%;">
                </video>
            	<div class="left">
			        <img id="car-photo" src="https://ss0.bdstatic.com/70cFuHSh_Q1YnxGkpoWK1HF6hhy/it/u=4190027971,3083551657&fm=26&gp=0.jpg" style="width:100%;height:auto;" alt=""/>
			    </div>
			    <div class="right">
	                <ul class="profile">
			            <li>
			                <ul class="profile-text">
			                    <li><b>任务号</b></li>
			                    <li id="car-task">YJ1235</li>
			                </ul>
			            </li>
			            <li>
			                <ul class="profile-text">
			                    <li><b>车牌号</b></li>
			                    <li id="car-id">京A1234</li>
			                </ul>
			            </li>
                        <li>
                            <ul class="profile-text">
                                <li><b>车型</b></li>
                                <li id="car-type">单厢车</li>
                            </ul>
                        </li>
<!-- 			            <li>
			                <ul class="profile-text">
			                    <li><b>品牌</b></li>
			                    <li id="car-brand">一汽大众</li>
			                </ul>
			            </li> -->
			            <li>
			                <ul class="profile-text">
			                    <li><b>颜色</b></li>
			                    <li id="car-color">黑色</li>
			                </ul>
			            </li>
			            <li>
			                <ul class="profile-text">
			                    <li><b>犯人</b></li>
			                    <li id="car-prisoners">张某某、李某某、王某某、赵某某、陈某某</li>
			                </ul>
			            </li>
			            <li>
			                <ul class="profile-text">
			                    <li><b>警员</b></li>
			                    <li id="car-polices">张警官、李警官、王警官、刘警官</li>
			                </ul>
			            </li>
			            <li>
			                <ul class="profile-text">
			                    <li><b>级别</b></li>
			                    <li id="car-level">一级</li>
			                </ul>
			            </li>
			        </ul>
		    	</div>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="alertInfoModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content" style="width:450px">
            <div class="modal-body">
                <ul class="profile" style="margin-left:4%">
                    <li>
                        <ul class="profile-text">
                            <li><b>任务号</b></li>
                            <li id="alert-task">YJ1235</li>
                        </ul>
                    </li>
		            <li>
                        <ul class="profile-text">
                            <li><b>时间</b></li>
                            <li id="alert-time">2019年10月19日13点25分</li>
                        </ul>
                    </li>
                    <li>
                        <ul class="profile-text">
                            <li><b>地点</b></li>
                            <li id="alert-location">女子监狱</li>
                        </ul>
                    </li>
                    <li>
                        <ul class="profile-text">
                            <li><b>经纬度</b></li>
                            <li id="alert-location">(116.2312, 39.2132)</li>
                        </ul>
                    </li>
		            <li>
		                <ul class="profile-text">
		                    <li><b>事件描述</b></li>
                            <li>
                                <input id="alert-detail" type="text" value="手持机状态异常" style="margin:0;font-size:1em;padding: 3px;width: 240px;"></input>
                                <a id="alert-save" href="#" style="margin-left: 10px">保存</a>
                            </li>
		                </ul>
		            </li>
		            <li>
		                <ul class="profile-text">
		                    <li><b>级别</b></li>
		                    <li id="alert-level">一般</li>
		                </ul>
		            </li>
		            <li>
		                <ul class="profile-text">
		                    <li><b>处理状态</b></li>
		                    <li>
                                <b id="alert-state">未处理</b>
                                <a id="alert-deal" href="#">设为已处理</a>
                                <a id="alert-error" href="#">设为误报</a>
                            </li>
		                </ul>
		            </li>
		            <li>
                        <ul class="profile-text">
                            <li><b>涉及车辆</b></li>
                            <li id="alert-car">京A1234</li>
                        </ul>
                    </li>
		            <li>
		                <ul class="profile-text">
		                    <li><b>涉及犯人</b></li>
		                    <li id="alert-prisoners">张三</li>
		                </ul>
		            </li>
		            <li>
		                <ul class="profile-text">
		                    <li><b>涉及警察</b></li>
		                    <li id="alert-polices">张卫国</li>
		                </ul>
		            </li>
		        </ul>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="prisonerInfoModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-body">
            	<div class="left">
			        <img id="prisoner-photo" src="http://img2.imgtn.bdimg.com/it/u=1973309565,2827282113&fm=26&gp=0.jpg" style="width:100%;height:auto;" alt=""/>
			    </div>
			    <div class="right">
	                <ul class="profile">
			            <li>
			                <ul class="profile-text">
			                    <li><b>犯人</b></li>
			                    <li id="prisoner-name">张某某</li>
			                </ul>
			            </li>
			            <li>
			                <ul class="profile-text">
			                    <li><b>年龄</b></li>
			                    <li id="prisoner-age">23</li>
			                </ul>
			            </li>
			            <li>
			                <ul class="profile-text">
			                    <li><b>性别</b></li>
			                    <li id="prisoner-sex">男</li>
			                </ul>
			            </li>
			            <li>
			                <ul class="profile-text">
			                    <li><b>学历</b></li>
			                    <li id="prisoner-education">高中</li>
			                </ul>
			            </li>
			            <li>
			                <ul class="profile-text">
			                    <li><b>身高</b></li>
			                    <li id="prisoner-height">178cm</li>
			                </ul>
			            </li>
			            <li>
			                <ul class="profile-text">
			                    <li><b>体重</b></li>
			                    <li id="prisoner-weight">74kg</li>
			                </ul>
			            </li>
			            <li>
			                <ul class="profile-text">
			                    <li><b>体脂率</b></li>
			                    <li id="prisoner-bodyfat">15.2%</li>
			                </ul>
			            </li>
			            <li>
			                <ul class="profile-text">
			                    <li><b>罪行</b></li>
			                    <li id="prisoner-crime">使用炸药袭击五角大楼</li>
			                </ul>
			            </li>
			            <li>
			                <ul class="profile-text">
			                    <li><b>前科</b></li>
			                    <li id="prisoner-record">使用炸药袭击白宫，窃取FBI机密情报，组织针对好莱坞的恐怖袭击</li>
			                </ul>
			            </li>
			            <li>
			                <ul class="profile-text">
			                    <li><b>备注</b></li>
			                    <li id="prisoner-remark">擅长炸药制作</li>
			                </ul>
			            </li>
                        <li>
                            <ul class="profile-text">
                                <li style="width:30%"><b>所在车辆</b></li>
                                <li id="prisoner-car">京PFT838</li>
                            </ul>
                        </li>
                        <li>
                            <ul class="profile-text">
                                <li style="width:30%"><b>负责警官</b></li>
                                <li id="prisoner-police">张卫国</li>
                            </ul>
                        </li>
			        </ul>
			    </div>
            </div>
        </div>
    </div>
</div>

<!--   Core JS Files   -->
<script src="../static/js/jquery-3.1.1.min.js" type="text/javascript"></script>
<script src="../static/js/bootstrap.min.js" type="text/javascript"></script>
<script src="../static/js/jquery-ui.js" type="text/javascript"></script>
<script src="../static/js/perfect-scrollbar.jquery.min.js" type="text/javascript"></script>
<script src="https://webapi.amap.com/maps?v=1.4.14&key=7dd5769916609fcc5c889c1797c4ebd7"></script>
<script src="../static/js/moment-with-locales.js"></script>
<script src="../static/js/jquery.flot.js"></script>
<script src="../static/js/bootstrap-datetimepicker.min.js"></script>
<script src="../static/js/bootstrap-datetimepicker.zh-CN.js" type="text/javascript"></script>
<script src="../static/js/amaze.js"></script>
<script src="../static/js/cookie.js"></script>
<!--<script src="../static/js/bootstrap-submenu.js"></script>-->
<script src="../static/js/ezuikit.js"></script>
<script type="text/javascript" src="../static/js/echarts.js"></script>
<script src="../static/js/device.js"></script>
<script src="../static/js/constants.js"></script>
<!-- <script type="text/javascript" src="../static/js/input.js"></script> 加了这个会出现底部滚动条，有bug -->
<!-- <script type="text/javascript" src="../static/js/rolling.js"></script> -->
<script type="text/javascript" src="../static/js/route.js"></script>
<script src="https://cdn.jsdelivr.net/npm/js-cookie@2/src/js.cookie.min.js"></script>

<script type="text/javascript">
    // 监控
    // var video1=new EZUIPlayer({
    //     id: 'video1',
    //     // autoplay: true,
    //     // url: 'http://hls.open.ys7.com/openlive/f01018a141094b7fa138b9d0b856507b.m3u8',
    //     // accessToken: 'at.23hqfag85ypahqi2aty36nck4o22nomx-7eekzi3exi-1dkodox-ng1ybplnu',
    //     // decoderPath: '../static/img',
    //     // width: 600,
    //     // height: 400,
    //     // handleError: handleError,
    // });
    $(document).ready(function () {
        var video1 = new EZUIKit.EZUIPlayer('video1');
        video1.play();
        var video2 = new EZUIKit.EZUIPlayer('video2');
        video2.play();

        //getAllDevices();

        //使得新模态框放在最前面
        $(document).on('show.bs.modal', '.modal', function() {
            var zIndex = 1040 + (10 * $('.modal:visible').length);
            $(this).css('z-index', zIndex);
            setTimeout(function() {
                $('.modal-backdrop').not('.modal-stack').css('z-index', zIndex - 1).addClass('modal-stack');
            }, 0);
        });
    });
    var getNetworkDelayTimer = setInterval(function () {
		$.ajax({
	        url:'http://' + server_ip_port + '/dvcM/networkCondition',
	        type:'GET',
	        dataType:'json',
	        async:true,
	        success:function (msg) {
	        	$('#delay').html(msg.delay + "ms")
	        }
	    });
	}, 2000)
    function showInfoModal(info) {
        $('#info_modal').html(info)
        $('#showInfoModal').modal('show')
        setTimeout(function(){
            $("#showInfoModal").modal("hide")
        },5000);
    }
</script>
<!-- <script type="text/javascript">
    // $(function () {
    $(".datetimePicker").datetimepicker({
        language:'zh-CN',
        autoclose:true,
        startView:2,
        tadayBtn:true,
        format:'yyyy-mm-dd',
        minView:2,
        initialDate:new Date()
    });//当在日期表中选择完时间后日期表就会自动关闭

    //changeCamera
    function changeCamera(obj) {
        console.log(obj.id);
        $('#myDropdown1').html(obj.id);
    }

</script> -->
<script type="text/javascript">
    //全屏浏览
    $(document).ready(function () {
        // var deviceFullScreen = document.getElementById("deviceFullScreen");
        // deviceFullScreen.onclick = function () {
        //     // mobileDevice-chart
        //     // var mobileDevice=document.getElementById('mobileDevice-chart');
        //     var deviceInfo=document.getElementById('deviceInfo-chart');
        //     // mobileDevice.style.height='70vh';
        //     deviceInfo.style.height='30vh';
        //     var deviceScreen = document.getElementById('device');
        //     requestFullScreen(deviceScreen)
        // };
        var mapFullScreen = document.getElementById("mapFullScreen");
        mapFullScreen.onclick = function () {
            var deviceScreen = document.getElementById('map-chart');
            console.log('fullScreen')
            requestFullScreen(deviceScreen);
        };
        
        var requestFullScreen = function (element) {
            var requestMethod = element.requestFullScreen
                || element.webkitRequestFullScreen //谷歌
                || element.mozRequestFullScreen  //火狐
                || element.msRequestFullScreen; //IE11
            if (requestMethod) {
                requestMethod.call(element);   //执行这个请求的方法
            } else if (typeof window.ActiveXObject !== "undefined") {  //window.ActiveXObject判断是否支持ActiveX控件
                //这里其实就是模拟了按下键盘的F11，使浏览器全屏
                var wscript = new ActiveXObject("WScript.Shell"); //创建ActiveX
                if (wscript !== null) {    //创建成功
                    wscript.SendKeys("{F11}");//触发f11
                }
            }
        };

    })
</script>

<script type="text/javascript">
    // window.init = function(){
    var markers = []
    var map
    $(document).ready(function () {
        map = new AMap.Map('map-chart', {
                resizeEnable:true,
                center: [116.397428, 39.90923],
                zoom: 17,
                mapStyle:"amap://styles/normal"
            }
        );
        // var polyline = new AMap.Polyline({
        //     map: map,
        //     path: lineArr.data,
        //     showDir:true,
        //     strokeColor: "#364150",  //线颜色
        //     // strokeOpacity: 1,     //线透明度
        //     strokeWeight: 6,      //线宽
        //     // strokeStyle: "solid"  //线样式
        // });


        //动态轨迹
        // var passedPolyline = new AMap.Polyline({
        //     map: map,
        //     // path: lineArr.data,
        //     strokeColor: "#47dbd4",  //线颜色
        //     // strokeOpacity: 1,     //线透明度
        //     strokeWeight: 6,      //线宽
        //     // strokeStyle: "solid"  //线样式
        // });
        
        var mapCenterTimer=setInterval(function () {
            if(markers.length > 0) {
                map.setCenter(markers[0].getPosition());
            }
        },500);

        //给location添加点击事件 点击之后停止计时，地图可平移；再次点击，回到车辆所在位置
        var location=document.getElementById("location");
        var flag=false;
        location.onclick = function () {
            if(flag==false){  //地图可平移
                clearInterval(mapCenterTimer);
                map.setStatus(true);
                flag=true;
                location.setAttribute('style','right:60px;background:url("../static/img/re_location.png")')
                // console.log(flag);
                // markers.forEach(marker => {
                // 	marker.pauseMove( )
                // })
                // markers[0].setIcon('../static/img/red_car.png')
            }else { //回到车辆位置
                mapCenterTimer=setInterval(function () {
                    if(markers.length > 0) {
		                map.setCenter(markers[0].getPosition());
		            }
                },500);
                flag=false;
                location.setAttribute('style','right:60px;background:url("../static/img/location.png")')

                // markers.forEach(marker => {
                // 	marker.resumeMove( )
                // })
                // markers[0].setIcon('../static/img/car.png')
                // console.log(flag);
            }
        };


        map.setFitView();

        // 创建一个 Icon
        var startIcon = new AMap.Icon({
            // 图标尺寸
            size: new AMap.Size(25, 34),
            // 图标的取图地址
            image: '//a.amap.com/jsapi_demos/static/demo-center/icons/dir-marker.png',
            // 图标所用图片大小
            imageSize: new AMap.Size(135, 40),
            // 图标取图偏移量
            imageOffset: new AMap.Pixel(-9, -3)
        });

        // 将 icon 传入 marker
        var startMarker = new AMap.Marker({
            position: new AMap.LngLat(116.478935,39.997761),
            icon: startIcon,
            offset: new AMap.Pixel(-13, -30)
        });
        map.add(startMarker);
        //添加一个计算机设备图标
        var pcIcon = new AMap.Icon({
            // 图标尺寸
            size: new AMap.Size(35, 41),
            // 图标的取图地址
            image: '../static/img/pc.png',
            // 图标所用图片大小
            imageSize: new AMap.Size(35, 41),
            // 图标取图偏移量
            imageOffset: new AMap.Pixel(0, 0)
        });

        // 将 icon 传入 marker
        var pcMarker1 = new AMap.Marker({
            position: new AMap.LngLat(116.485699,39.999761),
            icon: pcIcon,
            offset: new AMap.Pixel(-13, -30)
        });
        var pcMarker2 = new AMap.Marker({
            position: new AMap.LngLat(116.485769,39.998861),
            icon: pcIcon,
            offset: new AMap.Pixel(-13, -30)
        });
        map.add(pcMarker1);
        map.add(pcMarker2);
        // 添加一个手持机设备图标
        var phIcon = new AMap.Icon({
            // 图标尺寸
            size: new AMap.Size(35, 43),
            // 图标的取图地址
            image: '../static/img/ph.png',
            // 图标所用图片大小
            imageSize: new AMap.Size(35, 43),
            // 图标取图偏移量
            imageOffset: new AMap.Pixel(0, 0)
        });

        // 将 icon 传入 marker
        var phMarker = new AMap.Marker({
            position: new AMap.LngLat(116.480151,39.999453),
            icon: phIcon,
            offset: new AMap.Pixel(-13, -30)
        });
        var phMarker1 = new AMap.Marker({
            position: new AMap.LngLat(116.483151,39.998453),
            icon: phIcon,
            offset: new AMap.Pixel(-13, -30)
        });
        map.add(phMarker1);
        map.add(phMarker);
        //添加平板设备图标
        var paIcon = new AMap.Icon({
            // 图标尺寸
            size: new AMap.Size(35, 42),
            // 图标的取图地址
            image: '../static/img/pa.png',
            // 图标所用图片大小
            imageSize: new AMap.Size(35, 42),
            // 图标取图偏移量
            imageOffset: new AMap.Pixel(0, 0)
        });

        // 将 icon 传入 marker
        var paMarker = new AMap.Marker({
            position: new AMap.LngLat(116.478708,39.998555),
            icon: paIcon,
            offset: new AMap.Pixel(-13, -30)
        });
        map.add(paMarker);
        //小型计算中心
        var clIcon = new AMap.Icon({
            // 图标尺寸
            size: new AMap.Size(35, 42),
            // 图标的取图地址
            image: '../static/img/cl.png',
            // 图标所用图片大小
            imageSize: new AMap.Size(35, 42),
            // 图标取图偏移量
            imageOffset: new AMap.Pixel(0, 0)
        });

        // 将 icon 传入 marker
        var clMarker = new AMap.Marker({
            position: new AMap.LngLat(116.4845508,39.999555),
            icon: clIcon,
            offset: new AMap.Pixel(-13, -30)
        });
        map.add(clMarker);
        //添加路由器
        var lyIcon = new AMap.Icon({
            // 图标尺寸
            size: new AMap.Size(35, 42),
            // 图标的取图地址
            image: '../static/img/ly.png',
            // 图标所用图片大小
            imageSize: new AMap.Size(35, 42),
            // 图标取图偏移量
            imageOffset: new AMap.Pixel(0, 0)
        });

        // 将 icon 传入 marker
        var lyMarker1 = new AMap.Marker({
            position: new AMap.LngLat(116.479708,39.998444),
            icon: lyIcon,
            offset: new AMap.Pixel(-13, -30)
        });
        var lyMarker2 = new AMap.Marker({
            position: new AMap.LngLat(116.479998,39.9988444),
            icon: lyIcon,
            offset: new AMap.Pixel(-13, -30)
        });
        var lyMarker3 = new AMap.Marker({
            position: new AMap.LngLat(116.4799998,39.997944),
            icon: lyIcon,
            offset: new AMap.Pixel(-13, -30)
        });
        var lyMarker4 = new AMap.Marker({
            position: new AMap.LngLat(116.483509,39.997944),
            icon: lyIcon,
            offset: new AMap.Pixel(-13, -30)
        });
        var lyMarker5 = new AMap.Marker({
            position: new AMap.LngLat(116.4823598,39.998944),
            icon: lyIcon,
            offset: new AMap.Pixel(-13, -30)
        });
        map.add(lyMarker5);
        map.add(lyMarker4);
        map.add(lyMarker1);
        map.add(lyMarker2);
        map.add(lyMarker3);
        //基站
        var jzIcon = new AMap.Icon({
            // 图标尺寸
            size: new AMap.Size(35, 42),
            // 图标的取图地址
            image: '../static/img/jz.png',
            // 图标所用图片大小
            imageSize: new AMap.Size(35, 42),
            // 图标取图偏移量
            imageOffset: new AMap.Pixel(0, 0)
        });

        // 将 icon 传入 marker
        var jzMarker1 = new AMap.Marker({
            position: new AMap.LngLat(116.482008,39.998000),
            icon: jzIcon,
            offset: new AMap.Pixel(-13, -30)
        });
        map.add(jzMarker1);


        AMap.plugin(['AMap.ToolBar','AMap.Scale','AMap.Weather','AMap.OverView'],function(){//异步同时加载多个插件
            var toolbar = new AMap.ToolBar();
            map.addControl(toolbar);
            var scale = new AMap.Scale();
            map.addControl(scale);
            var overview = new AMap.OverView({
                visible: true
            });

            map.addControl(overview);
        });
    })
</script>


<script type="text/javascript">
    var prisoners = [{'id': '李海伟', 'img': '../static/img/prisoner1.png'}, {'id': '王大民', 'img': '../static/img/prisoner2.png'}, {'id': '肖某某', 'img': '../static/img/peo.png'}, {'id': '刘某某', 'img': '../static/img/peo.png'}, {'id': '高某某', 'img': '../static/img/peo.png'}, {'id': '李某某', 'img': '../static/img/peo.png'}, ]
    var selected_prisoner = {'id': ''}
    var row_num = 4
    function setPrisonersTable(data, filter) {
        var table_string = "<tr>";
        var count = 0;
        var filter_data = []
        data.forEach(prisoner => {
            if(prisoner.prisonerName.indexOf(filter) > -1) {
                filter_data.push(prisoner)
            }
        })
        filter_data.forEach(prisoner => {
            if(count % row_num == 0) {
                table_string += "</tr><tr>"
            }
            var prisoner_photo = prisoner.prisonerPhotoUri
            if(prisoner_photo == undefined || prisoner_photo == null) {
                prisoner_photo = "../static/img/peo.png"
            }
            var risk_level = prisoner.risk_level
            if(risk_level == undefined || risk_level == null) {
                risk_level = "暂无"
            }
            var heart_rate = prisoner.heart_rate
            if(heart_rate == undefined || heart_rate == null) {
                heart_rate = "暂无"
            }
            table_string += '<td><div class="cardBox"><div style="vertical-align:middle;text-align: center;display: table-cell;border: 0px;width:20%;height: 120px;"><img src="' + prisoner_photo + '" style="text-align: center;vertical-align: middle;max-width:100%;max-height:80%;"/></div><a href="#">' + prisoner.prisonerName + '</a><br><a href="#">风险：' + risk_level + '</a><br><a href="#">心率：' + heart_rate + '</a></div></td>'
            //table_string += '<th><a href="#">' + prisoner.id + "</a></th>"
            count += 1
        })
        table_string += "</tr>"
        $('#prisoner-table tbody').html(table_string)
        $("#prisoner-table td").click(function(){
            var thSeq = $(this).parent().find("td").index($(this)[0]);
            var trSeq = $(this).parent().parent().find("tr").index($(this).parent()[0]) - 1;
            selected_prisoner = filter_data[row_num * trSeq + thSeq];
            setPrisonerNamePhoto()
            
            $('#choosePrisonerModal').modal('hide')
        });
    }

    function getPrisonerById(prisonerId) {
        for (var i = 0; i < prisoners.length; i++) {
            if(prisoners[i].prisonerId === prisonerId) {
                return i
            }
        }
        return -1
    }

	var riskData = []
    var riskDate = []
    function setPrisonerNamePhoto() {
    	initRiskData()
    	$('#prisoner').html(selected_prisoner.prisonerName);
    	if(selected_prisoner.prisonerPhotoUri !== undefined && selected_prisoner.prisonerPhotoUri != null) {
            document.getElementById('prisoner-avatar').src = selected_prisoner.prisonerPhotoUri
        } else {
            document.getElementById('prisoner-avatar').src = "../static/img/peo.png"
        }
        var car_index = getCarMarkerById(selected_prisoner.carNo)
        if(car_index != -1) {
            markers[car_index].setIcon('../static/img/yellow_car.png')
        }
    }
    function setPrisonerInfo(prisoner) {
        $('#prisoner-name').html(prisoner.prisonerName)
        $('#prisoner-age').html(prisoner.age)
        $('#prisoner-sex').html(prisoner.gender)
        $('#prisoner-education').html(prisoner.educationBackground)
        $('#prisoner-height').html(prisoner.height)
        $('#prisoner-weight').html(prisoner.weight)
        $('#prisoner-bodyfat').html(prisoner.bodyFatRate)
        $('#prisoner-crime').html(prisoner.crime)
        $('#prisoner-record').html(prisoner.criminalRecord)
        $('#prisoner-remark').html(prisoner.comment)
        if(prisoner.prisonerPhotoUri != undefined && prisoner.prisonerPhotoUri != null) {
            document.getElementById('prisoner-photo').src = prisoner.prisonerPhotoUri
            document.getElementById('prisoner-avatar').src = prisoner.prisonerPhotoUri
        } else {
            document.getElementById('prisoner-photo').src = "../static/img/peo.png"
        }
    }
    function showPrisonerInfo(){
    	if(selected_prisoner.prisonerId == undefined) {
    		showInfoModal("请选择犯人")
    		return
    	}
        // $('#prisoner').html(selected_prisoner.id);
        $.ajax({
	        url:'http://' + server_ip_port + '/usrM/prisoners/get?prisonerId=' + selected_prisoner.prisonerId,
	        type:'GET',
	        dataType:'json',
	        async:true,
	        success:function (msg) {
	        	setPrisonerInfo(msg)
	        	$('#prisonerInfoModal').modal('show')
	        }
	    });
    };

    function randomData() {
       var now = new Date();
       var value = Math.random() * 50;
       return {
           'value': [
               [now.getHours(), now.getMinutes(), now.getSeconds()].join(':'),
               Math.round(50),
               Math.round(50)
           ]
       }
   	}

    var realtimeChart
    var alerts = []
    var selected_alert
    var all_risk_data = []
   	function initRiskData() {
   		riskDate = []
    	riskData = []
	   	for (var i = 0; i < 1000; i++) {
	       riskData.push(randomData());
	       riskDate.push('')
	   	}
        all_risk_data.forEach(prisoner => {
            if(prisoner.id === selected_prisoner.prisonerId) {
                riskData.push(prisoner.value)
                riskDate.push(prisoner.value[0]);
            }
        })
   	}

    $(document).ready(
	   function () {
	       // var device=device.deviceGetAll();
           //realtimeChart 实时数据
           realtimeChart = echarts.init(document.getElementById("realtime-chart"));

           realtimeOption = {
               // title: {
               //     text: '动态数据 + 时间坐标轴'
               // },
               // legend: {
               //     data:['心率','风险指数']
               // },
               grid:{
                   x:'8%',
                   y:'5%',
                   x2:'30%',
                   y2:'28%',
               },
               tooltip: {
                   trigger: 'axis',
                   formatter: function (params) {
                       params = params[0];
                       return params.value[0] + ' <br/>' + '风险指数：' + params.value[1] + '%' + '<br/>' + '心率：' + params.value[2];
                   },
                   axisPointer: {
                       animation: false
                   }
               },
               xAxis: {
                   type: 'category',
                   splitLine: {//控制网格的线条样式
                       show:false,
                   },
                   axisLabel:{                 //设置数据的样式，这里设置的是白色
                       textStyle:{
                           color:'#fff'
                       }
                   },
                   axisLine:{                 //设置X坐标的样式，这里设置的是白色
                       lineStyle:{
                           color:'#fff'
                       }
                   },
                   data: riskDate
               },
               dataZoom: [{
                   type: 'slider',
                   show: true,
                   xAxisIndex: [0],
                   left: '7%',
                   bottom: '10%',
                   height:'5%',
                   start: 99,
                   end: 100 //初始化滚动条
               }],
               yAxis: {
                   type: 'value',
                   splitLine: {//控制网格的线条样式
                       show:true,
                   },
                   axisLabel:{                 //设置数据的样式，这里设置的是白色
                       textStyle:{
                           color:'#fff'
                       }
                   },
                   boundaryGap: [0, '100%'],
                   min: 0,
                   max: 100,
               },
               series: [{
                   name: '实时数据',
                   type: 'line',
                   showSymbol: false,
                   hoverAnimation: false,
                   data: riskData,
                   lineStyle: {
                       color: 'rgba(132,193,255,0.8)'
                   }
               }
               ]
           };

           setInterval(function () {
           		if(selected_prisoner.prisonerId == undefined || selected_prisoner.prisonerId == null) {
           			return
           		}
           		$.ajax({
			        url:'http://' + server_ip_port + '/riskM/prisonerData/getAll',
			        type:'GET',
			        dataType:'json',
			        async:true,
			        success:function (msg) {
                        var now = new Date();
                        msg.forEach(prisoner => {
                            var temp_data = {'value': [[now.getHours(), now.getMinutes(), now.getSeconds()].join(':'),Math.round(prisoner.risk_level), prisoner.heart_rate], 'id': prisoner.prisonerId}
                            all_risk_data.push(temp_data)
                            if(prisoner.prisonerId === selected_prisoner.prisonerId) {
                                selected_prisoner.heart_rate = prisoner.heart_rate
                                selected_prisoner.risk_level = prisoner.risk_level
                            }
                            var prisoner_index = getPrisonerById(prisoner.prisonerId);
                            if(prisoner_index != -1) {
                                prisoners[prisoner_index].heart_rate = prisoner.heart_rate
                                prisoners[prisoner_index].risk_level = prisoner.risk_level

                                var y=now.getFullYear();
                                var mt=now.getMonth()+1;
                                var day=now.getDate();
                                var h=now.getHours();//获取时
                                var m=now.getMinutes();//获取分
                                var s=now.getSeconds();//获取秒
                                if(prisoner.risk_level >= 80) {
                                    alerts.unshift({'prisoners': [prisoner.prisonerId], 'time': mt+"-"+day+" "+h+":"+m+":"+s+"", 'cars': [prisoners[prisoner_index].carNo], 'state': '1', 'level': '1'})
                                } else if(prisoner.risk_level >= 60) {
                                    alerts.unshift({'prisoners': [prisoner.prisonerId], 'time': mt+"-"+day+" "+h+":"+m+":"+s+"", 'cars': [prisoners[prisoner_index].carNo], 'state': '1', 'level': '2'})
                                }
                            }
                        })
                        setAlerts(alerts)
                        setPrisonersTable(prisoners, '')
			        	var _data = {value: [[now.getHours(), now.getMinutes(), now.getSeconds()].join(':'),Math.round(selected_prisoner.risk_level), selected_prisoner.heart_rate]}
		               	riskData.shift();
		               	// data1.shift();
		               	riskDate.shift();
		               	riskData.push(_data);
		               	// data1.push(_data*5);
		               	riskDate.push(_data.value[0]);

		               	realtimeChart.setOption({
		                   xAxis: {
		                       data: riskDate
		                   },
		                   series: [{
		                       data:riskData
		                   	}]
               			});
              			$('#prisoner_risk').html('风险：' + selected_prisoner.risk_level + '%')
                        if(selected_prisoner.heart_rate.length < 3) {
                            $('#prisoner_heartbeat').html('心率：' + selected_prisoner.heart_rate)
                        } else {
                            $('#prisoner_heartbeat').html('心率：暂无')
                        }
			        }
			   	});
           }, 5000);
           realtimeChart.setOption(realtimeOption);
       })
</script>

<script type="text/javascript">
    $(document).ready(function () {
        $.ajax({
            url:'http://' + server_ip_port + '/usrM/prisoners/get_all',
            type:'GET',
            dataType:'json',
            async:true,
            success:function (msg) {
                prisoners = []
                msg.forEach(prisoner => {
                    var current_prisoner = prisoner.prisoner
                    current_prisoner.taskNo = prisoner.task.taskNo
                    current_prisoner.carNo = prisoner.task.carNo
                    current_prisoner.userName = prisoner.task.userName
                    prisoners.push(current_prisoner)
                })
                setPrisonersTable(prisoners, '')
                if(prisoners.length > 0){
                    selected_prisoner = prisoners[0]
                    setPrisonerNamePhoto()
                }
            }
        });
        $('#prisoner').click(function () {
            $.ajax({
		        url:'http://' + server_ip_port + '/usrM/prisoners/get_all',
		        type:'GET',
		        dataType:'json',
		        async:true,
		        success:function (msg) {
                    prisoners = []
                    msg.forEach(prisoner => {
                        var current_prisoner = prisoner.prisoner
                        current_prisoner.taskNo = prisoner.task.taskNo
                        current_prisoner.carNo = prisoner.task.carNo
                        current_prisoner.userName = prisoner.task.userName
                        prisoners.push(current_prisoner)
                    })
		        	setPrisonersTable(prisoners, '')
		        	$('#choosePrisonerModal').modal('show')
		        }
		    });
        })
        $("#filter-prisoner").bind("input propertychange",function(event){
            var filter = $("#filter-prisoner").val()
            setPrisonersTable(prisoners, filter)
        });
        // $('#refresh-device-chart').click(function () {
        //     getAllDevices()
        // })
    })
</script>

<script type="text/javascript">
	var tasks = [{'id':'YJ1234','level':'1','car':{'id':'京A1234','prisonerNum':'3','policeNum':'3'}},{'id':'YJ1234','level':'2','car':{'id':'京A1236','prisonerNum':'3','policeNum':'3'}},{'id':'YJ1234','level':'3','car':{'id':'京A1234','prisonerNum':'3','policeNum':'3'}},{'id':'YJ1235','level':'4','car':{'id':'京A1241','prisonerNum':'3','policeNum':'3'}},{'id':'YJ1234','level':'1','car':{'id':'京A1234','prisonerNum':'3','policeNum':'3'}},{'id':'YJ1234','level':'2','car':{'id':'京A1236','prisonerNum':'3','policeNum':'3'}},{'id':'YJ1234','level':'3','car':{'id':'京A1234','prisonerNum':'3','policeNum':'3'}},{'id':'YJ1235','level':'4','car':{'id':'京A1241','prisonerNum':'3','policeNum':'3'}},{'id':'YJ1234','level':'1','car':{'id':'京A1234','prisonerNum':'3','policeNum':'3'}},{'id':'YJ1234','level':'2','car':{'id':'京A1236','prisonerNum':'3','policeNum':'3'}},{'id':'YJ1234','level':'3','car':{'id':'京A1234','prisonerNum':'3','policeNum':'3'}},{'id':'YJ1235','level':'4','car':{'id':'京A1241','prisonerNum':'3','policeNum':'3'}}]
	var selected_task

	function setTasks(tasks) {
		var tasks_string = ""
		var task_title = []
		tasks.forEach(task => {
            var color = "#ffffff"
            var level = "无"
            if(task.level == '1') {
                color = "#FF2D2D"
                level = "一级"
            } else if(task.level == '2') {
                color = "#FFA042"
                level = "二级"
            } else if(task.level == '3') {
                color = "#FFED97"
                level = "三级"
            } else if(task.level == '4') {
                level = "四级"
            }
			tasks_string += "<tr title='任务号，车牌号，犯人数，警员数，级别'><td><a href='#' title='点击查看任务详情'>" + task.taskNo + "</a></td><td><a href='#' title='点击查看警车详情'>" + task.carNo + "</a></td><td>" + task.prisonerSum  
            + "</td><td>" + task.userSum + "</td><td style='color:" + color + "'>" + level + "</td></tr>"
		})

		var car_num = tasks.length
        var current_car_num = 0;
        var infoWindow
        map.remove(markers);
        var setCarTimer = setInterval(function () {
            if(current_car_num < car_num) {
                var marker = new AMap.Marker({
                    map: map,
                    position: lineArr.data.path_list[0].path[0].segments[0].coor[0],
                    //https://webapi.amap.com/images/car.png
                    icon: "../static/img/car.png",
                    offset: new AMap.Pixel(-26, -13),
                    autoRotation: true,
                    angle:-90,
                    pointIndex: 1,
                    pathIndex: 0,
                    segmentIndex: 0,
                    title:tasks[current_car_num].carNo,
                    task: tasks[current_car_num],
                    carIndex: current_car_num,
                });
                if(selected_prisoner.carNo != undefined && selected_prisoner.carNo != null&& tasks[current_car_num].carNo === selected_prisoner.carNo) {
                    marker.setIcon('../static/img/yellow_car.png')
                }
                marker.on('moveend', function () {
                	var last = lineArr.data.path_list[0].path[this.B.pathIndex].segments[this.B.segmentIndex].coor[this.B.pointIndex]
                	getNextPoint(this.B)
                	var target = lineArr.data.path_list[0].path[this.B.pathIndex].segments[this.B.segmentIndex].coor[this.B.pointIndex]
                	while(last[0] == target[0] && last[1] == target[1]) {
                		getNextPoint(this.B)
                		last = target
                		target = lineArr.data.path_list[0].path[this.B.pathIndex].segments[this.B.segmentIndex].coor[this.B.pointIndex]
                	}
                    var distance = this.B.pointIndex > 0 ? lineArr.data.path_list[0].path[this.B.pathIndex].segments[this.B.segmentIndex].distance[this.B.pointIndex-1] : 1;
                    this.moveTo(target, carSpeed(distance))
                    // if(this.B.carIndex == 0 && this.B.pointIndex <= 1 && markers.length == car_num) {
                    // 	console.log("pauseMove")
                    // 	markers.forEach(marker =>{
                    // 		marker.pauseMove()
                    // 	})
                    // }
                });
                marker.on('click', function() {
			        $.ajax({
				        url:'http://' + server_ip_port + '/usrM/task/getAboutCar?carNo=' + this.B.title,
				        type:'GET',
				        dataType:'json',
				        async:true,
				        success:function (msg) {
				        	setCarInfo(msg)
		        			$('#carInfoModal').modal('show')
				        }
				    });
                });
                marker.moveTo(lineArr.data.path_list[0].path[0].segments[0].coor[1], 500)
                //marker.moveAlong(lineArr.data, 200);
                markers.push(marker);
                current_car_num++;
                console.log(current_car_num)
            } else {
            	clearInterval(setCarTimer)
            }
        },4000);

        // setInterval(function () {
        // 	markers.forEach(marker => {
        // 		marker.resumeMove()
        // 	})
        // }, 8000)

		$('#task-table tbody').html(tasks_string)
		$("#task-table td a").click(function(){
	        var tdSeq = $(this).parent()[0].cellIndex;
	        var trSeq = $(this).parent().parent()[0].rowIndex - 1;
	        selected_task = tasks[trSeq];
	        // $('#prisoner').html(selected_prisoner.id);
	        if(tdSeq === 0) {
	        	$.ajax({
			        url:'http://' + server_ip_port + '/usrM/task/getTask?taskNo=' + selected_task.taskNo,
			        type:'GET',
			        dataType:'json',
			        async:true,
			        success:function (msg) {
			        	setTaskInfo(msg)
			        	$('#taskInfoModal').modal('show')
			        }
			    });
	        } else {
	        	$.ajax({
			        url:'http://' + server_ip_port + '/usrM/task/getAboutCar?carNo=' + selected_task.carNo,
			        type:'GET',
			        dataType:'json',
			        async:true,
			        success:function (msg) {
			        	setCarInfo(msg)
	        			$('#carInfoModal').modal('show')
			        }
			    });
	        }
	        // clearInterval(taskTableScollTimer);
	        // canTaskScroll = false
	    });	
	}

	function getNextPoint(next) {
		if(next.pointIndex + 1 == lineArr.data.path_list[0].path[next.pathIndex].segments[next.segmentIndex].coor.length) {
        	next.pointIndex = 0;
        	if(next.segmentIndex + 1 == lineArr.data.path_list[0].path[next.pathIndex].segments.length) {
            	next.segmentIndex = 0;
            	if(next.pathIndex + 1 == lineArr.data.path_list[0].path.length) {
                	next.pathIndex = 0;
                	showInfoModal('抵达目的地')
                } else {
                	next.pathIndex++
                }
            } else {
            	next.segmentIndex++
            }
        } else {
        	next.pointIndex++
        }
	}
	//setTasks(tasks.sort((a,b) => {return a.level - b.level}))

    function switchVideo(videoId, url) {
        var video = new EZUIKit.EZUIPlayer(videoId);
        video.stop();
        var video_dom = document.getElementById(videoId)
        var parent = video_dom.parentElement;
        parent.removeChild(video_dom);
        video_dom.setAttribute('src', url);
        parent.appendChild(video_dom);
        video = new EZUIKit.EZUIPlayer(videoId);
        video.play();
    }

    function getCarMarkerById(carNo) {
        for (var i = 0; i < markers.length; i++) {
            if(markers[i].B.title === carNo) {
                return i
            }
        }
        return -1
    }

	var getAllCarInfoTimer = setInterval(function () {
		$.ajax({
	        url:'http://' + server_ip_port + '/usrM/task/getAllTasks',
	        type:'GET',
	        dataType:'json',
	        async:true,
	        success:function (msg) {
	        	if(!isEquals(msg, tasks)) {
	        		tasks = msg.sort((a,b) => {return a.level - b.level});
	            	setTasks(tasks)
	        	}
	        }
	    });
	}, 1000)

    $('#taskInfoModal').on('hide.bs.modal', function () {
	 	// taskTableScollTimer = setInterval(moveTaskScoll, 50);
	 	// canTaskScroll = true
	});
	$('#carInfoModal').on('hide.bs.modal', function () {
	 	// taskTableScollTimer = setInterval(moveTaskScoll, 50);
	 	// canTaskScroll = true
	 	switchVideo('video3', '')
	});

    function setTaskInfo(task) {
        $('#task-id').html(task.taskNo)
        $('#task-cars').html(task.carNo)
        $('#task-prisoners').html(task.prisoner)
        $('#task-polices').html(task.user)
        var level = "无"
        if(task.level == '1') {
            level = "一级"
        } else if(task.level == '2') {
            level = "二级"
        } else if(task.level == '3') {
            level = "三级"
        } else if(task.level == '4') {
            level = "四级"
        }
        $('#task-level').html(level)
        $('#task-detail').html(task.detail)
    }

    function setCarInfo(car) {
        $('#car-task').html(car.taskNo)
        $('#car-id').html(car.carNo)
        $('#car-type').html(car.type)
        // $('#car-brand').html(car.brand)
        $('#car-color').html(car.color)
        $('#car-prisoners').html(car.prisoner)
        $('#car-polices').html(car.user)
        var level = "无"
        if(car.level == '1') {
            level = "一级"
        } else if(car.level == '2') {
            level = "二级"
        } else if(car.level == '3') {
            level = "三级"
        } else if(car.level == '4') {
            level = "四级"
        }
        $('#car-level').html(level)
        if(car.carPhoto == undefined || car.carPhoto == null) {
        	document.getElementById('car-photo').src = '../static/img/no_img.jpeg'
        } else {
        	document.getElementById('car-photo').src = car.carPhoto
        }
        switchVideo('video3', 'http://vd4.bdstatic.com/mda-hmqps190r6746axi/sc/mda-hmqps190r6746axi.mp4');
        switchVideo('video1', 'http://vd4.bdstatic.com/mda-hmqps190r6746axi/sc/mda-hmqps190r6746axi.mp4');
    }

    function setAlerts(alerts) {
        var alerts_string = ""
        alerts.forEach(alert => {
            var color = "#ffffff"
            var level = "一般"
            var state = "处理完成"
            var alert_class = ""
            if(alert.state === '1') {
                state = "未处理"
                if(alerts_string === "") {
                    alert_class = 'currentAlert'
                } else {
                    alert_class = 'workingAlert'
                }
                if(alert.level === '1') {
                    color = "#FF2D2D"
                    level = '紧急'
                } else {
                    color = "#FFA042"
                    level = '一般'
                }
            } else {
                state = "已处理"
                if(alert.level === '1') {
                    color = "#FFDC35"
                    level = '紧急'
                } else {
                    level = '一般'
                }
            }
            alerts.forEach(alert => {
                if(alert.state === '2') {
                    alert.cars.forEach(carNo => {
                        var marker_index = getCarMarkerById(carNo)
                        if(marker_index != -1) {
                            markers[marker_index].setIcon('../static/img/car.png')
                        }
                    })
                }
            })
            alerts.forEach(alert => {
                if(alert.state === '1') {
                    alert.cars.forEach(carNo => {
                        var marker_index = getCarMarkerById(carNo)
                        if(marker_index != -1) {
                            markers[marker_index].setIcon('../static/img/red_car.png')
                        }
                    })
                }
            })
            
            var prisonerNames = ""
            alert.prisoners.forEach(prisonerNo => {
                var prisoner_index = getPrisonerById(prisonerNo)
                if(prisoner_index != -1) {
                    prisonerNames += prisoners[prisoner_index].prisonerName + ","
                }
            })
            if(prisonerNames.length > 0) {
                prisonerNames = prisonerNames.substring(0, prisonerNames.length - 1)
            }
            var carNames = ""
            alert.cars.forEach(carNo => {
                carNames += carNo + ","
            })
            if(carNames.length > 0) {
                carNames = carNames.substring(0, carNames.length - 1)
            }
            alerts_string += "<tr title='点击查看事件详情' class='" + alert_class + "'><td>" + prisonerNames + "</td><td>" + alert.time + "</td><td>" + carNames + "</td><td style='color:" + color + "'>" + state + "</td><td style='color:" + color + "'>" + level + "</td></tr>"
            //alerts_string += "<tr title='点击查看事件详情' class='" + alert_class + "'><td>" + alert.prisonerName + "</td><td>" + alert.time + "</td><td>" + "<img src='../static/img/locate.png' style='height:50%'/>" + alert.car + "</td><td style='color:" + color + "'>" + state + "</td><td style='color:" + color + "'>" + level + "</td></tr>"
            
        })
        $('#alert-table tbody').html(alerts_string)
        //只通过前端来修改状态可能会导致点击警告事件与获得所有警告函数冲突，两者同时访问alerts，存在异步问题
        $("#alert-table td").click(function(){
            var thSeq = $(this).parent().find("td").index($(this)[0]);
            var trSeq = $(this).parent().parent().find("tr").index($(this).parent()[0]);
            selected_alert = alerts[trSeq];
            //console.log(alerts[trSeq]);
            if(alerts[trSeq].state === '1') {
                alerts[trSeq].state = '2'
                setAlerts(alerts)
            }
            // $('#prisoner').html(selected_prisoner.id);
            //$('#alertInfoModal').modal('show')
            //clearInterval(alertTableScollTimer);
            //canAlertScroll = false
        });
    }
    // var alertTimer = setInterval(function () {
    //     setAlerts(alerts.sort((a, b) =>{return a.time.localeCompare(b.time)});
    // }, 3000)

    function setAlertInfo(alert) {
        $('#alert-task').html(alert.task)
        $('#alert-detail').html(alert.detail)
        $('#alert-level').html(alert.level)
        $('#alert-state').html(alert.state)
        $('#alert-time').html(alert.time)
        $('#alert-location').html(alert.location)
        $('#alert-prisoners').html(alert.prisoners)
        $('#alert-polices').html(alert.polices)
    }
    $("#alert-save").click(function(){
        showInfoModal("保存成功")
    });
    $("#alert-deal").click(function(){
        showInfoModal("修改成功")
    });
    $("#alert-error").click(function(){
        showInfoModal("成功设为误报")
    });
    $('#alertInfoModal').on('hide.bs.modal', function () {
	 	// alertTableScollTimer = setInterval(moveAlertScoll, 50);
	 	// canAlertScroll = true
	});
</script>

<script type="text/javascript">
	var deviceAll = [{'name': '云端', 'device_id': '213', 'kind': 'cloud','children':[{'name': '服务器1', 'device_id': '321', 'kind': 'server','children':[{'name': '手持机1', 'device_id': '312', 'kind': 'device', 'state': '1'},{'name': '手持机2', 'device_id': '555', 'kind': 'device', 'state': '1'},{'name': '手持机3', 'device_id': '53', 'kind': 'device', 'state': '0'},{'name': '手持机4', 'device_id': '53', 'kind': 'device', 'state': '1'}],}],}]
	var currentDevice = {'device_id': '无设备','deviceNo': ''}
    deviceChart = echarts.init(document.getElementById('device-chart'));
    deviceOption={
        series:{
            name:'树图',
            type:'tree',
            orient:'vertical',
            symbol: 'circle',
            symbolSize: 40,
            top: '8%', //距离上
            left: '1%', //左
            bottom: '20%', //下
            right: '5%', //右的距离
            itemStyle: {
                normal: {
                    label: {
                        show: true,
                        position: 'bottom',
                        textStyle: {
                            color: '#fdfdff',
                        }
                    },
                    lineStyle: {
                        color: '#fdfdff',
                        width: 1,
                        length:10,
                        type: 'broken' // 'curve'|'broken'|'solid'|'dotted'|'dashed'
                    }
                },
                emphasis: {
                    label: {
                        show: true
                    }
                }
            },
            data: []
        },
        tooltip: {
	        trigger: 'item',
	        formatter: function (params, ticket, callback) {
	        	var res = ''
	        	res += '<p>设备名：' + params.data.name + '</p>'
	        	if (params.value >= 2) {
	        		res += '<p>持有者：' + (params.data.userName == null ? '无' : params.data.userName) + '</p>'
	        		res += '<p>所压犯人：' + (params.data.prisonerName == null ? '无' : params.data.prisonerName) + '</p>'
	        		res += '<p>所属任务：' + (params.data.taskNo == null ? '无' : params.data.taskNo) + '</p>'
	        		res += '<p>所在车辆：' + (params.data.carNo == null ? '无' : params.data.carNo) + '</p>'
	        	}
	        	return res
	        }
	    }
    };
    deviceChart.setOption(deviceOption);

    function setDeviceTree(devices) {
    	var res = []
    	devices.forEach(device => {
    		var temp = {}
    		temp.device_id = device.device.id
    		temp.name = device.device.id
    		temp.deviceNo = device.device.deviceNo
    		if(device.device.deviceType === 'cloud') {
    			temp.value = 0
    			temp.symbol = 'image://../static/img/cloud.png'
    			temp.symbolSize = 50
    			temp.itemStyle = '{normal: {label: {show: false}}}'
    			if(device.children != undefined) {
    				temp.children = setDeviceTree(device.children)
    			}
    		} else if(device.device.deviceType == 'server') {
    			temp.value = 1
    			temp.symbol = 'image://../static/img/serverv3.png'
    			temp.symbolSize = 50
    			temp.itemStyle = '{normal: {label: {show: false}}}'
    			if(device.children != undefined) {
    				temp.children = setDeviceTree(device.children)
    			}
    		} else {
    			temp.name = "手持机" + temp.name
    			temp.userName = device.device.user.userName
    			temp.prisonerName = device.device.user.prisonerName
    			temp.prisonerId = device.device.user.prisonerId
    			temp.taskNo = device.task.taskNo
    			temp.carNo = device.task.carNo
    			if(device.device.deviceStatus == false) {
	                temp.value = 3
	                temp.symbol = 'image://../static/img/re_phone.png'
	                temp.itemStyle = "{normal: {color: '#fa6900',label: {show: true,position: 'right'},},emphasis: {label: {show: false}, borderWidth: 0}}"
	            } else {
	    			temp.value = 2
	    			temp.symbol = 'image://../static/img/phone.png'
	    			temp.itemStyle = "{normal: {color: '#fa6900',label: {show: true,position: 'right'},},emphasis: {label: {show: false}, borderWidth: 0}}"
	    		}
    		}
    		res.push(temp)
    	})
    	return res
    }

    var getAllDevicesTimer = setInterval(function () {
		$.ajax({
	        url:'http://' + server_ip_port + '/dvcM/devices/get_all',
	        type:'GET',
	        dataType:'json',
	        async:true,
	        success:function (msg) {
	        	if(!isDeviceNew(msg, deviceAll)) {
	        		console.log('new device')
	        		deviceAll=msg;
	        		var deviceTree = [{'device':{'id': '云端', 'deviceNo': '213', 'deviceType': 'cloud'},'children':[{'device':{'id': '服务器', 'deviceNo': '321', 'deviceType': 'server'},'children': deviceAll,}],}]
	            	deviceOption.series.data = setDeviceTree(deviceTree);
    				deviceChart.setOption(deviceOption);
    				setFirstDevice(deviceAll)
	        	}
	        }
	    });
	}, 2000)

    deviceInfoChart=echarts.init(document.getElementById("deviceInfo-chart"));
    deviceInfoOption={
        tooltip : {
            formatter: "{a} <br/>{c}%"
        },
        series : [
            {
                name: 'cpu占用率',
                type: 'gauge',
                z: 3,
                min: 0,
                max: 100,
                // startAngle: 180,
                // endAngle: 0,
                splitNumber: 10,
                radius: '80%',
                center: ['50%', '40%'],

                axisLine: {            // 坐标轴线
                    lineStyle: {       // 属性lineStyle控制线条样式
                        width: 5,
                        color : [ //表盘颜色
                            [ 0.2, "#0de9ff"],//0-50%处的颜色
                            // [ 0.7, "#fffe9b" ],//51%-70%处的颜色
                            [ 0.8, "#ff8018" ],//70%-90%处的颜色
                            [ 1,"#ff1701" ],//90%-100%处的颜色
                        ],
                    }

                },

                axisTick: {            // 坐标轴小标记
                    length: 10,        // 属性length控制线长
                    lineStyle: {       // 属性lineStyle控制线条样式
                        color: 'auto'
                    }
                },
                splitLine: {           // 分隔线
                    length: 15,         // 属性length控制线长
                    lineStyle: {       // 属性lineStyle（详见lineStyle）控制线条样式
                        color: 'auto'
                    }
                },
                axisLabel: {
                    show:false
                },

                title : {
                    color: '#fff',
                },
                itemStyle: {
                    normal: {
                        color: '#fff'
                    },
                },
                pointer:{
                    length:'80%',
                    width:4
                },
                detail : {
                    // 其余属性默认使用全局文本样式，详见TEXTSTYLE
                    // formatter: function (value) {
                    //     value = (value + '').split('.');
                    //     value.length < 2 && (value.push('00'));
                    //     return ('00' + value[0]).slice(-2)
                    //         + '.' + (value[1] + '00').slice(0, 2);
                    // },
                    formatter:'{value}%',
                    fontSize:12,
                    color:'#fff',

                    offsetCenter:['0','50%'],

                    rich: {}
                },
                data:[{value: 0, name: 'cpu'}]
            },
            {
                name: '内存占用率',
                type: 'gauge',
                center: ['20%', '40%'],    // 默认全局居中
                radius: '80%',
                min:0,
                max:100,
                splitNumber:10,
                axisLine: {            // 坐标轴线
                    lineStyle: {       // 属性lineStyle控制线条样式
                        width: 5,
                        color : [ //表盘颜色
                            [ 0.2, "#0de9ff"],//0-50%处的颜色
                            // [ 0.7, "#fffe9b" ],//51%-70%处的颜色
                            [ 0.8, "#ff8018" ],//70%-90%处的颜色
                            [ 1,"#ff1701" ],//90%-100%处的颜色
                        ],
                    }

                },
                pointer:{
                    length:'80%',
                    width:4
                },
                axisTick: {            // 坐标轴小标记
                    length: 10,        // 属性length控制线长
                    lineStyle: {       // 属性lineStyle控制线条样式
                        color: 'auto'
                    }
                },
                splitLine: {           // 分隔线
                    length: 15,         // 属性length控制线长
                    lineStyle: {       // 属性lineStyle（详见lineStyle）控制线条样式
                        color: 'auto'
                    }
                },
                axisLabel: {
                    show:false
                },

                title : {
                    // 其余属性默认使用全局文本样式，详见TEXTSTYLE
                    // fontWeight: 'bolder',
                    fontSize: 12,
                    color: '#fff',
                },
                itemStyle: {
                    normal: {
                        color: '#fff'
                    },
                },
                detail : {
                    // 其余属性默认使用全局文本样式，详见TEXTSTYLE
                    // formatter: function (value) {
                    //     value = (value + '').split('.');
                    //     value.length < 2 && (value.push('00'));
                    //     return ('00' + value[0]).slice(-2)
                    //         + '.' + (value[1] + '00').slice(0, 2);
                    // },
                    formatter:'{value}%',
                    fontSize:12,
                    color:'#fff',

                    offsetCenter:['0%','50%'],

                    rich: {}
                },
                data:[{value: 0, name: '内存'}]
            },
            {
                name: '耗电量',
                type: 'gauge',
                center: ['80%', '40%'],    // 默认全局居中
                radius: '80%',
                min: 0,
                max: 100,

                splitNumber: 10,
                axisLine: {            // 坐标轴线
                    lineStyle: {       // 属性lineStyle控制线条样式
                        width: 5,
                        color : [ //表盘颜色
                            [ 0.2, "#0de9ff"],//0-50%处的颜色
                            // [ 0.7, "#fffe9b" ],//51%-70%处的颜色
                            [ 0.8, "#ff8018" ],//70%-90%处的颜色
                            [ 1,"#ff1701" ],//90%-100%处的颜色
                        ],
                    }

                },
                axisTick: {            // 坐标轴小标记
                    length: 10,        // 属性length控制线长
                    lineStyle: {       // 属性lineStyle控制线条样式
                        color: 'auto'
                    }
                },
                itemStyle: {
                    normal: {
                        color: '#fff'
                    },
                },
                splitLine: {           // 分隔线
                    length: 15,         // 属性length控制线长
                    lineStyle: {       // 属性lineStyle（详见lineStyle）控制线条样式
                        color: 'auto'
                    }
                },
                axisLabel: {
                    show:false
                },
                pointer:{
                    length:'80%',
                    width:4
                },

                title : {
                    // 其余属性默认使用全局文本样式，详见TEXTSTYLE
                    // fontWeight: 'bolder',
                    fontSize: 12,
                    color: '#fff',
                },
                detail : {
                    // 其余属性默认使用全局文本样式，详见TEXTSTYLE
                    // formatter: function (value) {
                    //     value = (value + '').split('.');
                    //     value.length < 2 && (value.push('00'));
                    //     return ('00' + value[0]).slice(-2)
                    //         + '.' + (value[1] + '00').slice(0, 2);
                    // },
                    formatter:'{value}%',
                    fontSize:12,
                    color:'#fff',

                    offsetCenter:['0%','50%'],

                    rich: {}
                },
                data:[{value: 0, name: '耗电量'}]
            }
        ]

    };
    deviceInfoChart.setOption(deviceInfoOption);
    var socket;
    deviceChart.on('click', function(params) {
    	if(params.value === 2) {
    		setDeviceInfo(params.data)
		}
	})

	function setDeviceInfo(device) {
		if(device != null && currentDevice.deviceNo != device.deviceNo) {
			currentDevice.device_id = device.device_id
			currentDevice.deviceNo = device.deviceNo
			if(device.prisonerId != undefined && device.prisonerId != null) {
    			var prisoner_index = getPrisonerById(device.prisonerId)
                if(prisoner_index != -1) {
                    selected_prisoner = prisoners[prisoner_index]
                    setPrisonerNamePhoto()
                }
    		}
    		$('#device-title').html("手持机" + currentDevice.device_id + "  性能监控")
    		getDeviceStates()
		}
	}

	function setFirstDevice(deviceAll) {
    	var device = null
    	for(var i = 0; i < deviceAll.length; i++) {
    		if(deviceAll[i].device.deviceStatus) {
    			device = deviceAll[i];
    			break;
    		}
    	}
    	setDeviceInfo({'deviceNo': device.device.deviceNo, 'device_id': device.device.id})
    	// for(var i = 0; i < deviceAll.length; i++) {
    	// 	if(deviceAll[i].device.user.prisonerId != null) {
    	// 		selected_prisoner.prisonerName = deviceAll[i].device.user.prisonerName
    	// 		selected_prisoner.prisonerId = deviceAll[i].device.user.prisonerId
    	// 		setPrisonerNamePhoto()
    	// 		break;
    	// 	}
    	// }
    }

    window.addEventListener('resize', function() {
        chartResize();
        // var canvas = document.getElementsByClassName("canvas")[0];
        // canvas.style.height = "" + document.body.scrollHeight + "px";
    });

    function chartResize() {
        var device_chart = document.getElementById("device-chart");
        device_chart.style.height = "" + (device_chart.parentNode.offsetHeight) + "px";
        deviceOption.series.symbolSize = device_chart.parentNode.offsetHeight * 0.13
        console.log(deviceOption.series.symbolSize)
        deviceChart.setOption(deviceOption)
        deviceChart.resize();

        var deviceInfo_chart = document.getElementById("deviceInfo-chart");
        deviceInfo_chart.style.height = "" + (deviceInfo_chart.parentNode.offsetHeight) + "px";
        deviceInfoChart.resize()

        realtimeChart.resize();
    }

	function getDeviceStates() {
		if (typeof (WebSocket) == "undefined") {
		        console.log("遗憾：您的浏览器不支持WebSocket");
		    } else {
		        console.log("恭喜：您的浏览器支持WebSocket");

		        if(socket != undefined && socket.readyState == 1) {
	    			socket.close();
	    		}
		        socket = new WebSocket("ws://" + server_ip_port + "/dvcM/ws/webSocket/" + currentDevice.device_id);
		        //socket = new WebSocket("ws://" + "10.108.122.144:8089" + "/ws/webSocket/1");
		        //连接打开事件
		        socket.onopen = function() {
		            console.log("Socket 已打开");
		            socket.send("消息发送测试(From Client)");
		        };
		        //收到消息事件
		        socket.onmessage = function(msg) {
		            // console.log(msg.data);
		            // var reg0 = new RegExp('{' , "g");
		            // var reg1 = new RegExp("}","g");
		            // var temp=new RegExp('delay: (.*), pack' , "g").exec(msg.data)[1];
		            //  console.log(temp);
		            //设备的实时数据
		            //var devId=temp[0].replace('device:','').split(';')[0].split(':')[1];
		            var battery = new RegExp('battery: (.*)%, cpuRate' , "g").exec(msg.data)[1]
		            var cpuRate = new RegExp('cpuRate: (.*)%, memRate' , "g").exec(msg.data)[1]
		            var memRate = new RegExp('memRate: (.*)%}' , "g").exec(msg.data)[1]
		            var netDelay = new RegExp('delay: (.*), pack' , "g").exec(msg.data)[1]

		            console.log(deviceInfoOption.series[0].data)
		            deviceInfoOption.series[0].data[0].value = Number(memRate);
		            deviceInfoOption.series[1].data[0].value = Number(cpuRate);
		            deviceInfoOption.series[2].data[0].value = Number(battery);
		            deviceInfoChart.setOption(deviceInfoOption, true);
		            //document.getElementById("delay").innerHTML=netDelay+'ms';
		            //得到select的
		        };
		        //连接关闭事件
		        socket.onclose = function() {
		            console.log("Socket已关闭");
		        };
		        //发生了错误事件
		        socket.onerror = function() {
		            showInfoModal("Socket发生了错误");
		        }

		        //窗口关闭时，关闭连接
		        window.unload=function() {
		            socket.close();
		        };
		    }
	}
    // setInterval(function (){
    //     deviceInfoOption.series[0].data[0].value = (Math.random()*20).toFixed(1) - 0;
    //     deviceInfoOption.series[1].data[0].value = (Math.random()*20).toFixed(1) - 0;
    //     // deviceInfoOption.series[2].data[0].value = (Math.random()*8).toFixed(2) - 0;
    //     // deviceInfoOption.series[3].data[0].value = (Math.random()*2).toFixed(2) - 0;
    //     deviceInfoChart.setOption(deviceInfoOption,true);
    // },5000);



    /*var socket;
    var battery;
    var cpuRate ;
    var memRate ;
    var devId;
    if (typeof (WebSocket) == "undefined") {
        console.log("遗憾：您的浏览器不支持WebSocket");
    } else {
        console.log("恭喜：您的浏览器支持WebSocket");

        socket = new WebSocket("ws://" + server_ip_port + "//ws/webSocket/1");
        //连接打开事件
        socket.onopen = function() {
            console.log("Socket 已打开");
            socket.send("消息发送测试(From Client)");
        };
        //收到消息事件
        socket.onmessage = function(msg) {
            console.log(msg.data);
            var netDelay;
            var temp;

            var reg0 = new RegExp( '{' , "g" );
            var reg1 = new RegExp("}","g");
            temp=msg.data.replace('data:','').replace(reg0,'').replace(reg1,'').split(';');
            // console.log(temp);
            //设备的实时数据
            // devId=temp[0].replace('device:','').split(';')[0].split(':')[1];
            // battery=temp[0].replace('device:','').split(';')[1].split(':')[1];
            // cpuRate=temp[0].replace('device:','').split(';')[2].split(':')[1];
            // memRate=temp[0].replace('device:','').split(';')[3].split(':')[1];
            // console.log(devId);
            // mobileDeviceOption.series[0].data[].des = battery;
            //网络时延
            netDelay=temp[1].replace('Network:','').split(',')[0].split(':')[1];
            document.getElementById("delay").innerHTML=netDelay+'ms';
            //得到select的
        };
        //连接关闭事件
        socket.onclose = function() {
            console.log("Socket已关闭");
        };
        //发生了错误事件
        socket.onerror = function() {
            showInfoModal("Socket发生了错误");
        }

        //窗口关闭时，关闭连接
        window.unload=function() {
            socket.close();
        };
    }*/
</script>

</body>
</html>
