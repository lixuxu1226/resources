<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <title>index</title>
    <script type="text/javascript" src="../static/js/jquery.js"></script>
    <link rel="stylesheet" href="../static/css/comon0.css">
    <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no' name='viewport' >
    <meta name="viewport" content="width=device-width" >
    <link rel="stylesheet" href="../static/css/bootstrap.css">
    <link rel="stylesheet" href="../static/css/bootstrap.min.css">
    <link href="../static/css/amaze.css" rel="stylesheet" >
    <link href="../static/css/jquery-ui.css" rel="stylesheet">
    <link href="../static/css/themify-icons.css" rel="stylesheet">
    <link href="../static/css/main.css" rel="stylesheet">
    <link href="../static/css/input.css" rel="stylesheet">
    <style>

        .demo-placeholder {
            width: 100%;
            height: 100%;
            font-size: 14px;
            line-height: 1.2em;
            position: relative;
            margin-top: 8px;
            /*background-color: floralwhite;*/

        }
        .inner-placeholder{
            width: 40px;height: 40px;top:0px;
            position: absolute;
            /*z-index: ;*/

            right: 10px;
            top:10px;

        }
    </style>
</head>
<script>
    $(window).load(function(){
        $(".loading").fadeOut()
    })

    /****/
    $(document).ready(function(){
        var whei=$(window).width()
        $("html").css({fontSize:whei/20})
        $(window).resize(function(){
            var whei=$(window).width()
            $("html").css({fontSize:whei/20})
        });
    });
</script>
<body>
<div class="canvas" style="opacity: .2">
    <iframe frameborder="0" src="../static/js/index.html" style="width: 100%; height: 100%"></iframe>
</div>
<div class="loading">
    <div class="loadbox"> <img src="../static/img/loading.gif"> 页面加载中... </div>
</div>
<div class="head">
    <h1 style="margin-top: 5px">跨区域押解边缘风险预警平台</h1>
    <div class="function" style="left:.1rem; ">
        <nav class="nav nav5">
            <ul>
                <li>
                    <a href="#">实时监控</a>

                </li>
            </ul>
        </nav>
    </div>
    <div class="function" style="left:2.1rem; ">
        <nav class="nav nav5">
            <ul>
                <li>
                    <a href="#">设备管理</a>
                    <ul>
                        <li><a href="checkDevice_2.html">查看设备信息</a></li>
                        <li><a href="useDeviceLog.html">操作日志</a></li>
                    </ul>
                </li>
            </ul>
        </nav>
    </div>
    <div class="function" style="left:4.1rem; ">
        <nav class="nav nav5">
            <ul>
                <li>
                    <a href="#">用户管理</a>
                    <ul>
                        <li><a href="user-profile_2.html">查看用户信息</a></li>
                        <li><a href="#" id="logout">注销</a></li>
                    </ul>
                </li>
            </ul>
        </nav>
    </div>
    <div class="weather"><!--<img src="picture/weather.png"><span>多云转小雨</span>--><span id="showTime"></span></div>

    <script>
        var t = null;
        t = setTimeout(time,1000);//開始运行
        function time()
        {
            clearTimeout(t);//清除定时器
            dt = new Date();
            var y=dt.getFullYear();
            var mt=dt.getMonth()+1;
            var day=dt.getDate();
            var h=dt.getHours();//获取时
            var m=dt.getMinutes();//获取分
            var s=dt.getSeconds();//获取秒
            document.getElementById("showTime").innerHTML = y+"年"+mt+"月"+day+"日"+h+"时"+m+"分"+s+"秒";
            t = setTimeout(time,1000); //设定定时器，循环运行
        }
    </script>
</div>
<div class="mainbox">
    <ul class="clearfix">
        <li>
            <div class="boxall" style="height: 4.3rem">
                <!--<div class="alltitle">边缘设备</div>-->
<!--                <div id='deviceFullScreen' class="inner-placeholder" style="background: url(../static/img/fullScreen.png);z-index: 4"></div>-->
                <!--background: url(../static/img/fullScreen.png)-->

                <div class="content" style="height: 270px" id="device">
                        <!--<div class="row" style="height: 350px">-->
                    <div id="device-chart" class="demo-placeholder" style="height: 100%"></div>
                    <!-- <div id='refresh-device-chart' class="inner-placeholder" style="background: url(../static/img/refresh.png)"></div> -->
                </div>
            </div>
            <div class="boxall" style="height: 2.1rem">
                <!--<div class="alltitle">设备状态</div>-->
                <div class="content">
                    <div id="deviceInfo-chart" class="demo-placeholder" style="height: 100%"></div>
                </div>
            </div>
            <div class="boxall" style="height: 3.1rem">
                <!--<div class="alltitle">统计数据</div>-->
                <div class="content">
                    <div class="demo-placeholder" style="height:170px; overflow:scroll; overflow-x:hidden">
                        <table id="task-table" style="text-align: center; border-collapse: separate;border-spacing: 8px 0px;width:99%;max-height:98%;">
                            <thead>
	                            <tr>
	                                <th><p>设备名</p></th>
	                                <th><p>任务</p></th>
	                            </tr>
                            </thead>
                            <tbody>
	                            <tr>
	                                <th>0</th>
	                                <th>暂无任务</th>
	                            </tr>
                            </tbody>
                        </table>

                    </div>
                </div>
            </div>
        </li>
        <li>
            <div class="map" style="height:6.4rem">
                <div class="card" style="height:100%; width: 100%;">

                    <div class="content" style="height:100%; width: 100%;">
                        <div id="map-chart" class="demo-placeholder" style="height: 100%"></div>
                        <div id='location' class="inner-placeholder" style="right:60px;background: url(../static/img/location.png)"></div>

                        <div id='mapFullScreen' class="inner-placeholder" style="background: url(../static/img/fullScreen.png)"></div>
                    </div>
                </div>
            </div>
            <div class="boxall" style="margin-top:14px;height: 3.1rem">
                <div class="alltitle">风险指数以及犯人数据</div>
                <div class="card" style="height:100%; width: 100%;">
                    <div id="realtime-chart" class="demo-placeholder"></div>
                    <div class="inner-placeholder" style="width:100px;height:116px;background:url(../static/img/peo.png);margin-right: 15px;margin-top: -10px">

                    </div>
                    <div class="inner-placeholder" style="margin-top: 110px;margin-right: 15px;width: 100px;height:50px">
                        <nav class="nav nav5">
                            <ul>
                                <li>
                                    <a href="#" id="prisoner">选择</a>
                                </li>
                            </ul>
                        </nav>
                    </div>
                </div>
            </div>
        </li>
        <li>
            <div class="boxall" style="height:3.17rem">
<!--                <nav class="nav nav5" style="margin-left: 30%;margin-right: 30%; height: .5rem;">-->
<!--                    <ul>-->
<!--                        <li>-->
<!--                            <a id="myDropdown1">A车摄像头1号</a>-->
<!--                            <ul>-->
<!--                                <li><a id="A车摄像头2号" onclick="changeCamera(this)">A车摄像头2号</a></li>-->
<!--                                <li><a id="A车摄像头3号" onclick="changeCamera(this)">A车摄像头3号</a></li>-->
<!--                            </ul>-->
<!--                        </li>-->
<!--                    </ul>-->
<!--                </nav>-->
                <video id="video1" src="http://ivi.bupt.edu.cn/hls/cctv14.m3u8" width=100%; controls playsInline webkit-playsinline [autoplay] style="padding-top: 1%">
                </video>
            </div>
            <div class="boxall" style="height: 3.17rem">
<!--                <nav class="nav nav5" style="margin-left: 30%;margin-right: 30%; height: .5rem;">-->
<!--                    <ul>-->
<!--                        <li>-->
<!--                            <a href="#">B车摄像头2号</a>-->
<!--                            <ul>-->
<!--                                <li><a id="B车摄像头1号" onclick="changeCamera(this)">B车摄像头1号</a></li>-->
<!--                                <li><a id="B车摄像头3号" onclick="changeCamera(this)">B车摄像头3号</a></li>-->
<!--                            </ul>-->
<!--                        </li>-->
<!--                    </ul>-->
<!--                </nav>-->
                <video id="video2" src="http://ivi.bupt.edu.cn/hls/cctv6.m3u8" width=100%;  controls playsInline webkit-playsinline [autoplay] style="padding-top: 1%">
                </video>
            </div>
            <div class="boxall" style="height: 3.16rem">
<!--                <nav class="nav nav5" style="margin-left: 30%;margin-right: 30%; height: .5rem;">-->
<!--                    <ul>-->
<!--                        <li>-->
<!--                            <a href="#">C车摄像头1号</a>-->
<!--                            <ul>-->
<!--                                <li><a id="C车摄像头2号" onclick="changeCamera(this)">C车摄像头2号</a></li>-->
<!--                            </ul>-->
<!--                        </li>-->
<!--                    </ul>-->
<!--                </nav>-->
                <video id="video3" src="../static/img/16.mp4" width=100%; controls playsInline webkit-playsinline [autoplay] style="padding-top: 1%">
                </video>
            </div>
        </li>
    </ul>
</div>
<div class="back"></div>
<!-- Modal -->
<div class="modal fade" id="choosePrisonerModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-body">
                <input id="filter-prisoner" type="text" placeholder="搜索" style="color:#ffffff;width: 90%;display:block;margin-left:auto;margin-right:auto;"></input>
                <table id="prisoner-table" style="margin: auto; border-collapse: separate; border-spacing:8px 5px">
                    <tbody>
                        <tr><td>暂无</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>


<!--   Core JS Files   -->
<script src="../static/js/jquery-3.1.1.min.js" type="text/javascript"></script>
<script src="../static/js/bootstrap.min.js" type="text/javascript"></script>
<script src="../static/js/jquery-ui.js" type="text/javascript"></script>
<script src="../static/js/perfect-scrollbar.jquery.min.js" type="text/javascript"></script>
<script src="https://webapi.amap.com/maps?v=1.4.14&key=7dd5769916609fcc5c889c1797c4ebd7"></script>
<script src="../static/js/moment-with-locales.js"></script>
<script src="../static/js/jquery.flot.js"></script>
<script src="../static/js/bootstrap-datetimepicker.min.js"></script>
<script src="../static/js/bootstrap-datetimepicker.zh-CN.js" type="text/javascript"></script>
<script src="../static/js/amaze.js"></script>
<script src="../static/js/cookie.js"></script>
<!--<script src="../static/js/bootstrap-submenu.js"></script>-->
<script src="../static/js/ezuikit.js"></script>
<script src="../static/js/flot-charts.js"></script>
<script type="text/javascript" src="../static/js/echarts.js"></script>
<script src="../static/js/device.js"></script>
<script src="../static/js/constants.js"></script>
<!-- <script type="text/javascript" src="../static/js/input.js"></script> 加了这个会出现底部滚动条，有bug -->
<script type="text/javascript" src="../static/js/logout.js"></script>

<script type="text/javascript">
    // 监控
    // var video1=new EZUIPlayer({
    //     id: 'video1',
    //     // autoplay: true,
    //     // url: 'http://hls.open.ys7.com/openlive/f01018a141094b7fa138b9d0b856507b.m3u8',
    //     // accessToken: 'at.23hqfag85ypahqi2aty36nck4o22nomx-7eekzi3exi-1dkodox-ng1ybplnu',
    //     // decoderPath: '../static/img',
    //     // width: 600,
    //     // height: 400,
    //     // handleError: handleError,
    // });
    $(document).ready(function () {
        var video1 = new EZUIKit.EZUIPlayer('video1');
        video1.play();
        var video2 = new EZUIKit.EZUIPlayer('video2');
        video2.play();
        var video3 = new EZUIKit.EZUIPlayer('video3');
        video3.play();
        //getAllDevices();
    });

    window.addEventListener('resize', function() {
        var canvas = document.getElementsByClassName("canvas")[0];
        canvas.style.height = "" + document.body.scrollHeight + "px";
    });
</script>
<script type="text/javascript">
    // $(function () {
    $(".datetimePicker").datetimepicker({
        language:'zh-CN',
        autoclose:true,
        startView:2,
        tadayBtn:true,
        format:'yyyy-mm-dd',
        minView:2,
        initialDate:new Date()
    });//当在日期表中选择完时间后日期表就会自动关闭
    //初始化

    window.addEventListener("resize", function () {

        // mobileDeviceChart.resize();
        realtimeChart.resize();

    });
    //changeCamera
    function changeCamera(obj) {
        console.log(obj.id);
        $('#myDropdown1').html(obj.id);
    }


</script>
<script type="text/javascript">
    //全屏浏览
    $(document).ready(function () {
        // var deviceFullScreen = document.getElementById("deviceFullScreen");
        // deviceFullScreen.onclick = function () {
        //     // mobileDevice-chart
        //     // var mobileDevice=document.getElementById('mobileDevice-chart');
        //     var deviceInfo=document.getElementById('deviceInfo-chart');
        //     // mobileDevice.style.height='70vh';
        //     deviceInfo.style.height='30vh';
        //     var deviceScreen = document.getElementById('device');
        //     requestFullScreen(deviceScreen)
        // };
        var mapFullScreen = document.getElementById("mapFullScreen");
        mapFullScreen.onclick = function () {
            var deviceScreen = document.getElementById('map-chart');
            console.log('fullScreen')
            requestFullScreen(deviceScreen);
        };



        var requestFullScreen = function (element) {
            var requestMethod = element.requestFullScreen
                || element.webkitRequestFullScreen //谷歌
                || element.mozRequestFullScreen  //火狐
                || element.msRequestFullScreen; //IE11
            if (requestMethod) {
                requestMethod.call(element);   //执行这个请求的方法
            } else if (typeof window.ActiveXObject !== "undefined") {  //window.ActiveXObject判断是否支持ActiveX控件
                //这里其实就是模拟了按下键盘的F11，使浏览器全屏
                var wscript = new ActiveXObject("WScript.Shell"); //创建ActiveX
                if (wscript !== null) {    //创建成功
                    wscript.SendKeys("{F11}");//触发f11
                }
            }
        };



    })
</script>

<script type="text/javascript">
    // window.init = function(){
    $(document).ready(function () {
        var marker,lineArr = [[116.478935,39.997761],[116.478939,39.997825],[116.478912,39.998549],[116.478912,39.998549],[116.478998,39.998555],[116.478998,39.998555],[116.479282,39.99856],[116.479658,39.998528],[116.480151,39.998453],[116.480784,39.998302],[116.480784,39.998302],[116.481149,39.998184],[116.481573,39.997997],[116.481863,39.997846],[116.482072,39.997718],[116.482362,39.997718],[116.483633,39.998935],[116.48367,39.998968],[116.484648,39.999861]];

        var map = new AMap.Map('map-chart', {
                resizeEnable:true,
                center: [116.397428, 39.90923],
                zoom: 17,
                mapStyle:"amap://styles/darkblue"
            }
        );
        // var polyline = new AMap.Polyline({
        //     map: map,
        //     path: lineArr,
        //     showDir:true,
        //     strokeColor: "#364150",  //线颜色
        //     // strokeOpacity: 1,     //线透明度
        //     strokeWeight: 6,      //线宽
        //     // strokeStyle: "solid"  //线样式
        // });


        //动态轨迹
        marker = new AMap.Marker({
            map: map,
            position: [116.478935,39.997761],
            icon: "https://webapi.amap.com/images/car.png",
            offset: new AMap.Pixel(-26, -13),
            autoRotation: true,
            angle:-90,
        });
        var passedPolyline = new AMap.Polyline({
            map: map,
            // path: lineArr,
            strokeColor: "#47dbd4",  //线颜色
            // strokeOpacity: 1,     //线透明度
            strokeWeight: 6,      //线宽
            // strokeStyle: "solid"  //线样式
        });


        marker.on('moving', function (e) {
            passedPolyline.setPath(e.passedPath);
        });
        marker.moveAlong(lineArr, 200);
        var inter=setInterval(function () {
            map.setCenter(marker.getPosition());
        },500);
        marker.on('click', function (e) {
            switchVideo('video1', 'http://ivi.bupt.edu.cn/hls/cctv1.m3u8');
        });
        function switchVideo(videoId, url) {
            var video = new EZUIKit.EZUIPlayer(videoId);
            video.stop();
            var video_dom = document.getElementById(videoId)
            var parent = video_dom.parentElement;
            parent.removeChild(video_dom);
            video_dom.setAttribute('src', url);
            parent.appendChild(video_dom);
            video = new EZUIKit.EZUIPlayer(videoId);
            video.play();
        }


        //给location添加点击事件 点击之后停止计时，地图可平移；再次点击，回到车辆所在位置
        var location=document.getElementById("location");
        var flag=false;
        location.onclick = function () {
            if(flag==false){  //地图可平移
                clearInterval(inter);
                map.setStatus(true);
                flag=true;
                location.setAttribute('style','right:60px;background:url("../static/img/re_location.png")')
                // console.log(flag);
            }else { //回到车辆位置
                map.setCenter(marker.getPosition());
                inter=setInterval(function () {
                    map.setCenter(marker.getPosition());
                },500);
                flag=false;
                location.setAttribute('style','right:60px;background:url("../static/img/location.png")')

                // console.log(flag);
            }
        };

        map.setFitView();

        // 创建一个 Icon
        var startIcon = new AMap.Icon({
            // 图标尺寸
            size: new AMap.Size(25, 34),
            // 图标的取图地址
            image: '//a.amap.com/jsapi_demos/static/demo-center/icons/dir-marker.png',
            // 图标所用图片大小
            imageSize: new AMap.Size(135, 40),
            // 图标取图偏移量
            imageOffset: new AMap.Pixel(-9, -3)
        });

        // 将 icon 传入 marker
        var startMarker = new AMap.Marker({
            position: new AMap.LngLat(116.478935,39.997761),
            icon: startIcon,
            offset: new AMap.Pixel(-13, -30)
        });
        map.add(startMarker);
        //添加一个计算机设备图标
        var pcIcon = new AMap.Icon({
            // 图标尺寸
            size: new AMap.Size(35, 41),
            // 图标的取图地址
            image: '../static/img/pc.png',
            // 图标所用图片大小
            imageSize: new AMap.Size(35, 41),
            // 图标取图偏移量
            imageOffset: new AMap.Pixel(0, 0)
        });

        // 将 icon 传入 marker
        var pcMarker1 = new AMap.Marker({
            position: new AMap.LngLat(116.485699,39.999761),
            icon: pcIcon,
            offset: new AMap.Pixel(-13, -30)
        });
        var pcMarker2 = new AMap.Marker({
            position: new AMap.LngLat(116.485769,39.998861),
            icon: pcIcon,
            offset: new AMap.Pixel(-13, -30)
        });
        map.add(pcMarker1);
        map.add(pcMarker2);
        // 添加一个手机设备图标
        var phIcon = new AMap.Icon({
            // 图标尺寸
            size: new AMap.Size(35, 43),
            // 图标的取图地址
            image: '../static/img/ph.png',
            // 图标所用图片大小
            imageSize: new AMap.Size(35, 43),
            // 图标取图偏移量
            imageOffset: new AMap.Pixel(0, 0)
        });

        // 将 icon 传入 marker
        var phMarker = new AMap.Marker({
            position: new AMap.LngLat(116.480151,39.999453),
            icon: phIcon,
            offset: new AMap.Pixel(-13, -30)
        });
        var phMarker1 = new AMap.Marker({
            position: new AMap.LngLat(116.483151,39.998453),
            icon: phIcon,
            offset: new AMap.Pixel(-13, -30)
        });
        map.add(phMarker1);
        map.add(phMarker);
        //添加平板设备图标
        var paIcon = new AMap.Icon({
            // 图标尺寸
            size: new AMap.Size(35, 42),
            // 图标的取图地址
            image: '../static/img/pa.png',
            // 图标所用图片大小
            imageSize: new AMap.Size(35, 42),
            // 图标取图偏移量
            imageOffset: new AMap.Pixel(0, 0)
        });

        // 将 icon 传入 marker
        var paMarker = new AMap.Marker({
            position: new AMap.LngLat(116.478708,39.998555),
            icon: paIcon,
            offset: new AMap.Pixel(-13, -30)
        });
        map.add(paMarker);
        //小型计算中心
        var clIcon = new AMap.Icon({
            // 图标尺寸
            size: new AMap.Size(35, 42),
            // 图标的取图地址
            image: '../static/img/cl.png',
            // 图标所用图片大小
            imageSize: new AMap.Size(35, 42),
            // 图标取图偏移量
            imageOffset: new AMap.Pixel(0, 0)
        });

        // 将 icon 传入 marker
        var clMarker = new AMap.Marker({
            position: new AMap.LngLat(116.4845508,39.999555),
            icon: clIcon,
            offset: new AMap.Pixel(-13, -30)
        });
        map.add(clMarker);
        //添加路由器
        var lyIcon = new AMap.Icon({
            // 图标尺寸
            size: new AMap.Size(35, 42),
            // 图标的取图地址
            image: '../static/img/ly.png',
            // 图标所用图片大小
            imageSize: new AMap.Size(35, 42),
            // 图标取图偏移量
            imageOffset: new AMap.Pixel(0, 0)
        });

        // 将 icon 传入 marker
        var lyMarker1 = new AMap.Marker({
            position: new AMap.LngLat(116.479708,39.998444),
            icon: lyIcon,
            offset: new AMap.Pixel(-13, -30)
        });
        var lyMarker2 = new AMap.Marker({
            position: new AMap.LngLat(116.479998,39.9988444),
            icon: lyIcon,
            offset: new AMap.Pixel(-13, -30)
        });
        var lyMarker3 = new AMap.Marker({
            position: new AMap.LngLat(116.4799998,39.997944),
            icon: lyIcon,
            offset: new AMap.Pixel(-13, -30)
        });
        var lyMarker4 = new AMap.Marker({
            position: new AMap.LngLat(116.483509,39.997944),
            icon: lyIcon,
            offset: new AMap.Pixel(-13, -30)
        });
        var lyMarker5 = new AMap.Marker({
            position: new AMap.LngLat(116.4823598,39.998944),
            icon: lyIcon,
            offset: new AMap.Pixel(-13, -30)
        });
        map.add(lyMarker5);
        map.add(lyMarker4);
        map.add(lyMarker1);
        map.add(lyMarker2);
        map.add(lyMarker3);
        //基站
        var jzIcon = new AMap.Icon({
            // 图标尺寸
            size: new AMap.Size(35, 42),
            // 图标的取图地址
            image: '../static/img/jz.png',
            // 图标所用图片大小
            imageSize: new AMap.Size(35, 42),
            // 图标取图偏移量
            imageOffset: new AMap.Pixel(0, 0)
        });

        // 将 icon 传入 marker
        var jzMarker1 = new AMap.Marker({
            position: new AMap.LngLat(116.482008,39.998000),
            icon: jzIcon,
            offset: new AMap.Pixel(-13, -30)
        });
        map.add(jzMarker1);





        AMap.plugin(['AMap.ToolBar','AMap.Scale','AMap.Weather','AMap.OverView'],function(){//异步同时加载多个插件
            var toolbar = new AMap.ToolBar();
            map.addControl(toolbar);
            var scale = new AMap.Scale();
            map.addControl(scale);
            var overview = new AMap.OverView({
                visible: true
            });

            map.addControl(overview);




        });

        //犯人列表
        // var getPrisoner=document.getElementById("selectPrisoner");
        //
        // $.ajax({
        //     type:'GET',
        //     url:'http://' + server_ip_port + '/prisoners/get_all',
        //     data:{},
        //     dataType:'json',
        //     success:function (msg) {
        //         allPrisoners = ""
        //         $.each(msg,function (index,item){
        //             allPrisoners += "<li><a>" + item.prisonerName + "</a></li>"
        //         })
        //         getPrisoner.innerHTML = allPrisoners
        //     }
        // })
    })

    // }
</script>


<script type="text/javascript">
    var prisoners = [{'id': '肖申克', 'img': 'http://img2.imgtn.bdimg.com/it/u=1973309565,2827282113&fm=26&gp=0.jpg'}, {'id': '摩根', 'img': 'http://img0.imgtn.bdimg.com/it/u=3755574069,3463185667&fm=26&gp=0.jpg'}, {'id': '希特勒', 'img': 'https://ss0.baidu.com/6ONWsjip0QIZ8tyhnq/it/u=941443254,970138554&fm=179&app=42&f=JPEG?w=121&h=140'}, {'id': '赵家宝', 'img': '../static/img/peo.png'}, {'id': '万梓聪', 'img': '../static/img/peo.png'}, {'id': '王志鹏', 'img': '../static/img/peo.png'}, {'id': '秦晔', 'img': '../static/img/peo.png'}, {'id': '特朗普', 'img': 'https://ss1.bdstatic.com/70cFvXSh_Q1YnxGkpoWK1HF6hhy/it/u=3281731419,3181491992&fm=26&gp=0.jpg'}, {'id': '谢非', 'img': '../static/img/peo.png'}, {'id': '本拉登', 'img': 'https://ss2.baidu.com/6ONYsjip0QIZ8tyhnq/it/u=3565236029,2292350226&fm=179&app=42&f=PNG?w=121&h=140&s=FD19A9574433B384949139070300E0E1'}, {'id': '崔剑飞', 'img': '../static/img/peo.png'}, {'id': '陈积源', 'img': '../static/img/peo.png'}, {'id': '单傲', 'img': '../static/img/peo.png'}, {'id': '孙晟', 'img': '../static/img/peo.png'}]
    var selected_prisoner = {'id': 'null'}
    var row_num = 4
    function setPrisonersTable(data, filter) {
        var table_string = "<tr>";
        var count = 0;
        var filter_data = []
        data.forEach(prisoner => {
            if(prisoner.id.indexOf(filter) > -1) {
                filter_data.push(prisoner)
            }
        })
        filter_data.forEach(prisoner => {
            if(count % row_num == 0) {
                table_string += "</tr><tr>"
            }
            table_string += '<th><div class="cardBox"><div style="vertical-align:middle;text-align: center;display: table-cell;border: 0px;height: 120px;"><img src="' + prisoner.img + '" style="vertical-align: middle;width:100%;max-height: 100%;"/></div><a href="#">' + prisoner.id + "</a></div></th>"
            //table_string += '<th><a href="#">' + prisoner.id + "</a></th>"
            count += 1
        })
        table_string += "</tr>"
        $('#prisoner-table tbody').html(table_string)
        $("#prisoner-table th").click(function(){
            var thSeq = $(this).parent().find("th").index($(this)[0]);
            var trSeq = $(this).parent().parent().find("tr").index($(this).parent()[0]) - 1;
            selected_prisoner = filter_data[row_num * trSeq + thSeq];
            $('#prisoner').html(selected_prisoner.id);
            $('#choosePrisonerModal').modal('hide')
        });
    }
</script>

<script type="text/javascript">
    $(document).ready(function () {
        $('#prisoner').click(function () {
            $('#choosePrisonerModal').modal('show')
            setPrisonersTable(prisoners, '')
            // $.ajax({
            //     url:'http://' + server_ip_port + '/prisoner/get_all' + "?token=" + token,
            //     type:'GET',
            //     dataType:'json',
            //     success:function (msg) {
            //         prisoners = msg
            //         setPrisonersTable(prisoners, '')
            //         $('#choosePrisonerModal').modal('show')
            //     }
            // })
        })
        $("#filter-prisoner").bind("input propertychange",function(event){
            var filter = $("#filter-prisoner").val()
            setPrisonersTable(prisoners, filter)
        });
        // $('#refresh-device-chart').click(function () {
        //     getAllDevices()
        // })
    })
</script>

<script type="text/javascript">
	var tasks = []
	// setInterval(function () {
	// 	$.ajax({
	//         url:'http://' + server_ip_port + '/tasks/get_all',
	//         type:'GET',
	//         dataType:'json',
	//         async:false,
	//         success:function (msg) {
	//             tasks = msg;
	//             setTasks(tasks)
	//         }
	//     });
	// }, 5000)

	function setTasks(tasks) {
		var tasks_string = ""
		tasks.forEach(task => {
			tasks_string += "<tr><th>" + task.id + "</th><th>" + task.description + "</th></tr>"
		})
		$('#task-table tbody').html(tasks_string)
	}
	setTasks([{'id':'device1','description':'监视犯人赵家宝'},{'id':'device2','description':'监视犯人王志鹏'},{'id':'device4','description':'监视犯人万梓聪'}])
</script>

<script type="text/javascript">
	var deviceAll = []
	var currentDevice = {'name': '无设备', 'id': ''}
    deviceChart = echarts.init(document.getElementById('device-chart'));
    deviceOption={
        series:{
            name:'树图',
            type:'tree',
            orient:'vertical',
            height:180,
            symbol: 'circle',
            symbolSize: 40,
            itemStyle: {
                normal: {
                    label: {
                        show: true,
                        position: 'bottom',
                        textStyle: {
                            color: '#fdfdff',
                            fontSize: 10,

                        }
                    },
                    lineStyle: {
                        color: '#fdfdff',
                        width: 1,
                        length:20,
                        type: 'broken' // 'curve'|'broken'|'solid'|'dotted'|'dashed'
                    }
                },
                emphasis: {
                    label: {
                        show: true
                    }
                }
            },
            data: []
        }
    };
    deviceChart.setOption(deviceOption);

    function getAllDevices() {
    	$.ajax({
	        url:'http://' + server_ip_port + '/devices/get_all',
	        type:'GET',
	        dataType:'json',
	        async:false,
	        success:function (msg) {
	            deviceAll=msg;
	            deviceOption.series.data = setDeviceTree(msg);
    			deviceChart.setOption(deviceOption);
	        }
	    });
    }

    // setInterval(function (){
    //     getAllDevices()
    // },5000);

    function setDeviceTree(devices) {
    	var res = []
    	devices.forEach(device => {
    		var temp = {}
    		temp.name = device.name
    		temp.device_id = device.device_id
    		temp.symbolSize = [48, 48]
    		if(device.kind === 'cloud') {
    			temp.value = 0
    			temp.symbol = 'image://../static/img/cloud.png'
    			temp.itemStyle = '{normal: {label: {show: false}}}'
    			if(device.children != undefined) {
    				temp.children = setDeviceTree(device.children)
    			}
    		} else if(device.kind == 'server') {
    			temp.value = 1
    			temp.symbol = 'image://../static/img/serverv3.png'
    			temp.itemStyle = '{normal: {label: {show: false}}}'
    			if(device.children != undefined) {
    				temp.children = setDeviceTree(device.children)
    			}
    		} else if(device.state == '0') {
                temp.value = 3
                temp.symbol = 'image://../static/img/re_phone.png'
                temp.itemStyle = "{normal: {color: '#fa6900',label: {show: true,position: 'right'},},emphasis: {label: {show: false}, borderWidth: 0}}"
            } else {
    			temp.value = 2
    			temp.symbol = 'image://../static/img/phone.png'
    			temp.itemStyle = "{normal: {color: '#fa6900',label: {show: true,position: 'right'},},emphasis: {label: {show: false}, borderWidth: 0}}"
    		}
    		res.push(temp)
    	})
    	return res
    }
    deviceOption.series.data = setDeviceTree([{'name': 'cloud', 'device_id': '213', 'kind': 'cloud','children':[{'name': 'server1', 'device_id': '321', 'kind': 'server','children':[{'name': 'device1', 'device_id': '123', 'kind': 'device', 'state': '1'},{'name': 'device2', 'device_id': '555', 'kind': 'device', 'state': '1'},{'name': 'device3', 'device_id': '53', 'kind': 'device', 'state': '0'},{'name': 'device4', 'device_id': '53', 'kind': 'device', 'state': '1'}],}],}])
    deviceChart.setOption(deviceOption);


    deviceInfoChart=echarts.init(document.getElementById("deviceInfo-chart"));
    deviceInfoOption={
        title:{
            show: true,
            text: currentDevice.name,
            textStyle: {//主标题文本样式{"fontSize": 18,"fontWeight": "bolder","color": "#333"}
                fontSize: 16,
                color: '#fff',

            },
        },
        tooltip : {
            formatter: "{a} <br/>{c}%"
        },
        series : [
            {
                name: 'cpu占用率',
                type: 'gauge',
                z: 3,
                min: 0,
                max: 100,
                // startAngle: 180,
                // endAngle: 0,
                splitNumber: 10,
                radius: '70%',

                axisLine: {            // 坐标轴线
                    lineStyle: {       // 属性lineStyle控制线条样式
                        width: 5,
                        color : [ //表盘颜色
                            [ 0.2, "#0de9ff"],//0-50%处的颜色
                            // [ 0.7, "#fffe9b" ],//51%-70%处的颜色
                            [ 0.8, "#ff8018" ],//70%-90%处的颜色
                            [ 1,"#ff1701" ],//90%-100%处的颜色
                        ],
                    }

                },

                axisTick: {            // 坐标轴小标记
                    length: 10,        // 属性length控制线长
                    lineStyle: {       // 属性lineStyle控制线条样式
                        color: 'auto'
                    }
                },
                splitLine: {           // 分隔线
                    length: 15,         // 属性length控制线长
                    lineStyle: {       // 属性lineStyle（详见lineStyle）控制线条样式
                        color: 'auto'
                    }
                },
                axisLabel: {
                    show:false
                },

                title : {
                    // 其余属性默认使用全局文本样式，详见TEXTSTYLE
                    // fontWeight: 'bolder',
                    fontSize: 12,
                    color: '#fff',
                    offsetCenter:['-50%','110%'],
                },
                itemStyle: {
                    normal: {
                        color: '#fff'
                    },
                },
                pointer:{
                    length:'80%',
                    width:4
                },
                detail : {
                    // 其余属性默认使用全局文本样式，详见TEXTSTYLE
                    // formatter: function (value) {
                    //     value = (value + '').split('.');
                    //     value.length < 2 && (value.push('00'));
                    //     return ('00' + value[0]).slice(-2)
                    //         + '.' + (value[1] + '00').slice(0, 2);
                    // },
                    formatter:'{value}%',
                    fontSize:12,
                    color:'#fff',

                    offsetCenter:['100%','110%'],

                    rich: {}
                },
                data:[{value: 0, name: 'cpu占用率 :'}]
            },
            {
                name: '内存占用率',
                type: 'gauge',
                center: ['20%', '50%'],    // 默认全局居中
                radius: '70%',
                min:0,
                max:100,
                splitNumber:10,
                axisLine: {            // 坐标轴线
                    lineStyle: {       // 属性lineStyle控制线条样式
                        width: 5,
                        color : [ //表盘颜色
                            [ 0.2, "#0de9ff"],//0-50%处的颜色
                            // [ 0.7, "#fffe9b" ],//51%-70%处的颜色
                            [ 0.8, "#ff8018" ],//70%-90%处的颜色
                            [ 1,"#ff1701" ],//90%-100%处的颜色
                        ],
                    }

                },
                pointer:{
                    length:'80%',
                    width:4
                },
                axisTick: {            // 坐标轴小标记
                    length: 10,        // 属性length控制线长
                    lineStyle: {       // 属性lineStyle控制线条样式
                        color: 'auto'
                    }
                },
                splitLine: {           // 分隔线
                    length: 15,         // 属性length控制线长
                    lineStyle: {       // 属性lineStyle（详见lineStyle）控制线条样式
                        color: 'auto'
                    }
                },
                axisLabel: {
                    show:false
                },

                title : {
                    // 其余属性默认使用全局文本样式，详见TEXTSTYLE
                    // fontWeight: 'bolder',
                    fontSize: 12,
                    color: '#fff',
                    offsetCenter:['-50%','110%'],
                },
                itemStyle: {
                    normal: {
                        color: '#fff'
                    },
                },
                detail : {
                    // 其余属性默认使用全局文本样式，详见TEXTSTYLE
                    // formatter: function (value) {
                    //     value = (value + '').split('.');
                    //     value.length < 2 && (value.push('00'));
                    //     return ('00' + value[0]).slice(-2)
                    //         + '.' + (value[1] + '00').slice(0, 2);
                    // },
                    formatter:'{value}%',
                    fontSize:12,
                    color:'#fff',

                    offsetCenter:['100%','110%'],

                    rich: {}
                },
                data:[{value: 0, name: '内存占用率 :'}]
            },
            {
                name: '耗电量',
                type: 'gauge',
                center: ['80%', '50%'],    // 默认全局居中
                radius: '70%',
                min: 0,
                max: 100,

                splitNumber: 10,
                axisLine: {            // 坐标轴线
                    lineStyle: {       // 属性lineStyle控制线条样式
                        width: 5,
                        color : [ //表盘颜色
                            [ 0.2, "#0de9ff"],//0-50%处的颜色
                            // [ 0.7, "#fffe9b" ],//51%-70%处的颜色
                            [ 0.8, "#ff8018" ],//70%-90%处的颜色
                            [ 1,"#ff1701" ],//90%-100%处的颜色
                        ],
                    }

                },
                axisTick: {            // 坐标轴小标记
                    length: 10,        // 属性length控制线长
                    lineStyle: {       // 属性lineStyle控制线条样式
                        color: 'auto'
                    }
                },
                itemStyle: {
                    normal: {
                        color: '#fff'
                    },
                },
                splitLine: {           // 分隔线
                    length: 15,         // 属性length控制线长
                    lineStyle: {       // 属性lineStyle（详见lineStyle）控制线条样式
                        color: 'auto'
                    }
                },
                axisLabel: {
                    show:false
                },
                pointer:{
                    length:'80%',
                    width:4
                },

                title : {
                    // 其余属性默认使用全局文本样式，详见TEXTSTYLE
                    // fontWeight: 'bolder',
                    fontSize: 12,
                    color: '#fff',
                    offsetCenter:['-50%','110%'],
                },
                detail : {
                    // 其余属性默认使用全局文本样式，详见TEXTSTYLE
                    // formatter: function (value) {
                    //     value = (value + '').split('.');
                    //     value.length < 2 && (value.push('00'));
                    //     return ('00' + value[0]).slice(-2)
                    //         + '.' + (value[1] + '00').slice(0, 2);
                    // },
                    formatter:'{value}%',
                    fontSize:12,
                    color:'#fff',

                    offsetCenter:['70%','110%'],

                    rich: {}
                },
                data:[{value: 0, name: '耗电量 :'}]
            }
        ]

    };
    deviceInfoChart.setOption(deviceInfoOption);
    var socket;
    deviceChart.on('click', function(params) {
    	if(params.value === 2 && currentDevice.id != params.data.device_id) {
    		currentDevice.id = params.data.device_id
    		currentDevice.name = params.name
    		
    		deviceInfoOption.title.text = params.name
    		deviceInfoChart.setOption(deviceInfoOption);
    		getDeviceStates()
		}
	})

	function getDeviceStates() {
		if (typeof (WebSocket) == "undefined") {
		        console.log("遗憾：您的浏览器不支持WebSocket");
		    } else {
		        console.log("恭喜：您的浏览器支持WebSocket");

		        if(socket != undefined && socket.readyState == 1) {
	    			socket.close();
	    		}
		        socket = new WebSocket("ws://" + server_ip_port + "//ws/webSocket/" + currentDevice.id);
		        //连接打开事件
		        socket.onopen = function() {
		            console.log("Socket 已打开");
		            socket.send("消息发送测试(From Client)");
		        };
		        //收到消息事件
		        socket.onmessage = function(msg) {
		            console.log(msg.data);
		            var reg0 = new RegExp( '{' , "g" );
		            var reg1 = new RegExp("}","g");
		            var temp=msg.data.replace('data:','').replace(reg0,'').replace(reg1,'').split(';');
		            // console.log(temp);
		            //设备的实时数据
		            var devId=temp[0].replace('device:','').split(';')[0].split(':')[1];
		            var battery=temp[0].replace('device:','').split(';')[1].split(':')[1];
		            var cpuRate=temp[0].replace('device:','').split(';')[2].split(':')[1];
		            var memRate=temp[0].replace('device:','').split(';')[3].split(':')[1];
		            var netDelay=temp[1].replace('Network:','').split(',')[0].split(':')[1];

		            deviceInfoOption.series[3].data[0].value = memRate;
		            deviceInfoOption.series[3].data[1].value = cpuRate;
		            deviceInfoOption.series[3].data[2].value = battery;
		            deviceInfoChart.setOption(deviceInfoOption, true);
		            //document.getElementById("delay").innerHTML=netDelay+'ms';
		            //得到select的
		        };
		        //连接关闭事件
		        socket.onclose = function() {
		            console.log("Socket已关闭");
		        };
		        //发生了错误事件
		        socket.onerror = function() {
		            alert("Socket发生了错误");
		        }

		        //窗口关闭时，关闭连接
		        window.unload=function() {
		            socket.close();
		        };
		    }
	}
    // setInterval(function (){
    //     deviceInfoOption.series[0].data[0].value = (Math.random()*20).toFixed(1) - 0;
    //     deviceInfoOption.series[1].data[0].value = (Math.random()*20).toFixed(1) - 0;
    //     // deviceInfoOption.series[2].data[0].value = (Math.random()*8).toFixed(2) - 0;
    //     // deviceInfoOption.series[3].data[0].value = (Math.random()*2).toFixed(2) - 0;
    //     deviceInfoChart.setOption(deviceInfoOption,true);
    // },5000);



    /*var socket;
    var battery;
    var cpuRate ;
    var memRate ;
    var devId;
    if (typeof (WebSocket) == "undefined") {
        console.log("遗憾：您的浏览器不支持WebSocket");
    } else {
        console.log("恭喜：您的浏览器支持WebSocket");

        socket = new WebSocket("ws://" + server_ip_port + "//ws/webSocket/1");
        //连接打开事件
        socket.onopen = function() {
            console.log("Socket 已打开");
            socket.send("消息发送测试(From Client)");
        };
        //收到消息事件
        socket.onmessage = function(msg) {
            console.log(msg.data);
            var netDelay;
            var temp;

            var reg0 = new RegExp( '{' , "g" );
            var reg1 = new RegExp("}","g");
            temp=msg.data.replace('data:','').replace(reg0,'').replace(reg1,'').split(';');
            // console.log(temp);
            //设备的实时数据
            // devId=temp[0].replace('device:','').split(';')[0].split(':')[1];
            // battery=temp[0].replace('device:','').split(';')[1].split(':')[1];
            // cpuRate=temp[0].replace('device:','').split(';')[2].split(':')[1];
            // memRate=temp[0].replace('device:','').split(';')[3].split(':')[1];
            // console.log(devId);
            // mobileDeviceOption.series[0].data[].des = battery;
            //网络时延
            netDelay=temp[1].replace('Network:','').split(',')[0].split(':')[1];
            document.getElementById("delay").innerHTML=netDelay+'ms';
            //得到select的
        };
        //连接关闭事件
        socket.onclose = function() {
            console.log("Socket已关闭");
        };
        //发生了错误事件
        socket.onerror = function() {
            alert("Socket发生了错误");
        }

        //窗口关闭时，关闭连接
        window.unload=function() {
            socket.close();
        };
    }*/
</script>

</body>
</html>
